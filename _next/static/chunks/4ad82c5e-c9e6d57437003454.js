"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[762],{7421:function(a,b,c){c.d(b,{kH:function(){return $c},p:function(){return _c},Nm:function(){return nh},tk:function(){return mt},BF:function(){return _f},lg:function(){return dg},l9:function(){return Tc},Uw:function(){return mx},qr:function(){return dy},ZO:function(){return bz},AE:function(){return My},"$f":function(){return dx},OO:function(){return Wf},"W$":function(){return oz},"$1":function(){return gx}});var d=c(8120),e=c(172),f=c(8699),g=c(382),h=c(3952);function i(a){return(11==a.nodeType?a.getSelection?a:a.ownerDocument:a).getSelection()}function j(a,b){return!!b&&a.contains(1!=b.nodeType?b.parentNode:b)}function k(a,b){if(!b.anchorNode)return!1;try{return j(a,b.anchorNode)}catch(c){return!1}}function l(a){return 3==a.nodeType?w(a,0,a.nodeValue.length).getClientRects():1==a.nodeType?a.getClientRects():[]}function m(a,b,c,d){return!!c&&(o(a,b,c,d,-1)||o(a,b,c,d,1))}function n(a){for(var b=0;;b++)if(!(a=a.previousSibling))return b}function o(a,b,c,d,e){for(;;){if(a==c&&b==d)return!0;if(b==(e<0?0:p(a))){if("DIV"==a.nodeName)return!1;let f=a.parentNode;if(!f||1!=f.nodeType)return!1;b=n(a)+(e<0?0:1),a=f}else{if(1!=a.nodeType)return!1;if(1==(a=a.childNodes[b+(e<0?-1:0)]).nodeType&&"false"==a.contentEditable)return!1;b=e<0?p(a):0}}}function p(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}const q={left:0,right:0,top:0,bottom:0};function r(a,b){let c=b?a.left:a.right;return{left:c,right:c,top:a.top,bottom:a.bottom}}function s(a){return{left:0,right:a.innerWidth,top:0,bottom:a.innerHeight}}let t=null;function u(a){if(a.setActive)return a.setActive();if(t)return a.focus(t);let b=[];for(let c=a;c&&(b.push(c,c.scrollTop,c.scrollLeft),c!=c.ownerDocument);c=c.parentNode);if(a.focus(null==t?{get preventScroll(){return t={preventScroll:!0},!0}}:void 0),!t){t=!1;for(let d=0;d<b.length;){let e=b[d++],f=b[d++],g=b[d++];e.scrollTop!=f&&(e.scrollTop=f),e.scrollLeft!=g&&(e.scrollLeft=g)}}}let v;function w(a,b,c=b){let d=v||(v=document.createRange());return d.setEnd(a,c),d.setStart(a,b),d}function x(a,b,c){let d={key:b,code:b,keyCode:c,which:c,cancelable:!0},e=new KeyboardEvent("keydown",d);e.synthetic=!0,a.dispatchEvent(e);let f=new KeyboardEvent("keyup",d);return f.synthetic=!0,a.dispatchEvent(f),e.defaultPrevented||f.defaultPrevented}function y(a){for(;a.attributes.length;)a.removeAttributeNode(a.attributes[0])}class z{constructor(A,B,C=!0){this.node=A,this.offset=B,this.precise=C}static before(D,E){return new z(D.parentNode,n(D),E)}static after(F,G){return new z(F.parentNode,n(F)+1,G)}}const H=[];class I{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(J){let K=this.posAtStart;for(let L of this.children){if(L==J)return K;K+=L.length+L.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(M){return this.posBefore(M)+M.length}coordsAt(N,O){return null}sync(P){if(2&this.dirty){let Q=this.dom,R=Q.firstChild;for(let S of this.children){if(S.dirty){if(!S.dom&&R){let T=I.get(R);T&&(T.parent||T.constructor!=S.constructor)||S.reuseDOM(R)}S.sync(P),S.dirty=0}if(P&&!P.written&&P.node==Q&&R!=S.dom&&(P.written=!0),S.dom.parentNode==Q){for(;R&&R!=S.dom;)R=Pa(R);R=S.dom.nextSibling}else Q.insertBefore(S.dom,R)}for(R&&P&&P.node==Q&&(P.written=!0);R;)R=Pa(R)}else if(1&this.dirty)for(let U of this.children)U.dirty&&(U.sync(P),U.dirty=0)}reuseDOM(V){}localPosFromDOM(W,X){let Y;if(W==this.dom)Y=this.dom.childNodes[X];else{let Z=0==p(W)?0:0==X?-1:1;for(;;){let $=W.parentNode;if($==this.dom)break;0==Z&&$.firstChild!=$.lastChild&&(Z=W==$.firstChild?-1:1),W=$}Y=Z<0?W:W.nextSibling}if(Y==this.dom.firstChild)return 0;for(;Y&&!I.get(Y);)Y=Y.nextSibling;if(!Y)return this.length;for(let _=0,aa=0;;_++){let ba=this.children[_];if(ba.dom==Y)return aa;aa+=ba.length+ba.breakAfter}}domBoundsAround(ca,da,ea=0){let fa=-1,ga=-1,ha=-1,ia=-1;for(let ja=0,ka=ea,la=ea;ja<this.children.length;ja++){let ma=this.children[ja],na=ka+ma.length;if(ka<ca&&na>da)return ma.domBoundsAround(ca,da,ka);if(na>=ca&& -1==fa&&(fa=ja,ga=ka),ka>da&&ma.dom.parentNode==this.dom){ha=ja,ia=la;break}la=na,ka=na+ma.breakAfter}return{from:ga,to:ia<0?ea+this.length:ia,startDOM:(fa?this.children[fa-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:ha<this.children.length&&ha>=0?this.children[ha].dom:null}}markDirty(oa=!1){this.dirty|=2,this.markParentsDirty(oa)}markParentsDirty(pa){for(let qa=this.parent;qa;qa=qa.parent){if(pa&&(qa.dirty|=2),1&qa.dirty)return;qa.dirty|=1,pa=!1}}setParent(ra){this.parent!=ra&&(this.parent=ra,this.dirty&&this.markParentsDirty(!0))}setDOM(sa){this.dom&&(this.dom.cmView=null),this.dom=sa,sa.cmView=this}get rootView(){for(let ta=this;;){let ua=ta.parent;if(!ua)return ta;ta=ua}}replaceChildren(va,wa,xa=H){this.markDirty();for(let ya=va;ya<wa;ya++){let za=this.children[ya];za.parent==this&&za.destroy()}this.children.splice(va,wa-va,...xa);for(let Aa=0;Aa<xa.length;Aa++)xa[Aa].setParent(this)}ignoreMutation(Ba){return!1}ignoreEvent(Ca){return!1}childCursor(Da=this.length){return new Qa(this.children,Da,this.children.length)}childPos(Ea,Fa=1){return this.childCursor().findPos(Ea,Fa)}toString(){let Ga=this.constructor.name.replace("View","");return Ga+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==Ga?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(Ha){return Ha.cmView}get isEditable(){return!0}merge(Ia,Ja,Ka,La,Ma,Na){return!1}become(Oa){return!1}getSide(){return 0}destroy(){this.parent=null}}function Pa(a){let b=a.nextSibling;return a.parentNode.removeChild(a),b}I.prototype.breakAfter=0;class Qa{constructor(Ra,Sa,Ta){this.children=Ra,this.pos=Sa,this.i=Ta,this.off=0}findPos(Ua,Va=1){for(;;){if(Ua>this.pos||Ua==this.pos&&(Va>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=Ua-this.pos,this;let Wa=this.children[--this.i];this.pos-=Wa.length+Wa.breakAfter}}}function Xa(a,b,c,d,e,f,g,h,i){let{children:j}=a,k=j.length?j[b]:null,l=f.length?f[f.length-1]:null,m=l?l.breakAfter:g;if(!(b==d&&k&&!g&&!m&&f.length<2&&k.merge(c,e,f.length?l:null,0==c,h,i))){if(d<j.length){let n=j[d];n&&e<n.length?(b==d&&(n=n.split(e),e=0),!m&&l&&n.merge(0,e,l,!0,0,i)?f[f.length-1]=n:(e&&n.merge(0,e,null,!1,0,i),f.push(n))):(null==n?void 0:n.breakAfter)&&(l?l.breakAfter=1:g=1),d++}for(k&&(k.breakAfter=g,c>0&&(!g&&f.length&&k.merge(c,k.length,f[0],!1,h,0)?k.breakAfter=f.shift().breakAfter:(c<k.length||k.children.length&&0==k.children[k.children.length-1].length)&&k.merge(c,k.length,null,!1,h,0),b++));b<d&&f.length;)if(j[d-1].become(f[f.length-1]))d--,f.pop(),i=f.length?0:h;else if(j[b].become(f[0]))b++,f.shift(),h=f.length?0:i;else break;!f.length&&b&&d<j.length&&!j[b-1].breakAfter&&j[d].merge(0,0,j[b-1],!1,h,i)&&b--,(b<d||f.length)&&a.replaceChildren(b,d,f)}}function Ya(a,b,c,d,e,f){let g=a.childCursor(),{i:h,off:i}=g.findPos(c,1),{i:j,off:k}=g.findPos(b,-1),l=b-c;for(let m of d)l+=m.length;a.length+=l,Xa(a,j,k,h,i,d,0,e,f)}let Za="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},$a="undefined"!=typeof document?document:{documentElement:{style:{}}};const _a=/Edge\/(\d+)/.exec(Za.userAgent),ab=/MSIE \d/.test(Za.userAgent),bb=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Za.userAgent),cb=!!(ab||bb||_a),db=!cb&&/gecko\/(\d+)/i.test(Za.userAgent),eb=!cb&&/Chrome\/(\d+)/.exec(Za.userAgent),fb="webkitFontSmoothing"in $a.documentElement.style,gb=!cb&&/Apple Computer/.test(Za.vendor),hb=gb&&(/Mobile\/\w+/.test(Za.userAgent)||Za.maxTouchPoints>2);var ib={mac:hb||/Mac/.test(Za.platform),windows:/Win/.test(Za.platform),linux:/Linux|X11/.test(Za.platform),ie:cb,ie_version:ab?$a.documentMode||6:bb?+bb[1]:_a?+_a[1]:0,gecko:db,gecko_version:db?+(/Firefox\/(\d+)/.exec(Za.userAgent)||[0,0])[1]:0,chrome:!!eb,chrome_version:eb?+eb[1]:0,ios:hb,android:/Android\b/.test(Za.userAgent),webkit:fb,safari:gb,webkit_version:fb?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=$a.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class jb extends I{constructor(kb){super(),this.text=kb}get length(){return this.text.length}createDOM(lb){this.setDOM(lb||document.createTextNode(this.text))}sync(mb){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(mb&&mb.node==this.dom&&(mb.written=!0),this.dom.nodeValue=this.text)}reuseDOM(nb){3==nb.nodeType&&this.createDOM(nb)}merge(ob,pb,qb){return(!qb||qb instanceof jb&&!(this.length-(pb-ob)+qb.length>256))&&(this.text=this.text.slice(0,ob)+(qb?qb.text:"")+this.text.slice(pb),this.markDirty(),!0)}split(rb){let sb=new jb(this.text.slice(rb));return this.text=this.text.slice(0,rb),this.markDirty(),sb}localPosFromDOM(tb,ub){return tb==this.dom?ub:ub?this.text.length:0}domAtPos(vb){return new z(this.dom,vb)}domBoundsAround(wb,xb,yb){return{from:yb,to:yb+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(zb,Ab){return _b(this.dom,zb,Ab)}}class Bb extends I{constructor(Cb,Db=[],Eb=0){for(let Fb of(super(),this.mark=Cb,this.children=Db,this.length=Eb,Db))Fb.setParent(this)}setAttrs(Gb){if(y(Gb),this.mark.class&&(Gb.className=this.mark.class),this.mark.attrs)for(let Hb in this.mark.attrs)Gb.setAttribute(Hb,this.mark.attrs[Hb]);return Gb}reuseDOM(Ib){Ib.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(Ib),this.dirty|=6)}sync(Jb){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(Jb)}merge(Kb,Lb,Mb,Nb,Ob,Pb){return(!Mb|| !!(Mb instanceof Bb&&Mb.mark.eq(this.mark))&&(!Kb||!(Ob<=0))&&(!(Lb<this.length)||!(Pb<=0)))&&(Ya(this,Kb,Lb,Mb?Mb.children:[],Ob-1,Pb-1),this.markDirty(),!0)}split(Qb){let Rb=[],Sb=0,Tb=-1,Ub=0;for(let Vb of this.children){let Wb=Sb+Vb.length;Wb>Qb&&Rb.push(Sb<Qb?Vb.split(Qb-Sb):Vb),Tb<0&&Sb>=Qb&&(Tb=Ub),Sb=Wb,Ub++}let Xb=this.length-Qb;return this.length=Qb,Tb> -1&&(this.children.length=Tb,this.markDirty()),new Bb(this.mark,Rb,Xb)}domAtPos(Yb){return Nc(this.dom,this.children,Yb)}coordsAt(Zb,$b){return Pc(this,Zb,$b)}}function _b(a,b,c){let d=a.nodeValue.length;b>d&&(b=d);let e=b,f=b,g=0;0==b&&c<0||b==d&&c>=0?ib.chrome||ib.gecko||(b?(e--,g=1):(f++,g=-1)):c<0?e--:f++;let h=w(a,e,f).getClientRects();if(!h.length)return q;let i=h[(g?g<0:c>=0)?0:h.length-1];return ib.safari&&!g&&0==i.width&&(i=Array.prototype.find.call(h,a=>a.width)||i),g?r(i,g<0):i||null}class ac extends I{constructor(bc,cc,dc){super(),this.widget=bc,this.length=cc,this.side=dc}static create(ec,fc,gc){return new(ec.customView||ac)(ec,fc,gc)}split(hc){let ic=ac.create(this.widget,this.length-hc,this.side);return this.length-=hc,ic}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(jc,kc,lc,mc,nc,oc){return(!lc||lc instanceof ac&&!!this.widget.compare(lc.widget)&&(!(jc>0)||!(nc<=0))&&(!(kc<this.length)||!(oc<=0)))&&(this.length=jc+(lc?lc.length:0)+(this.length-kc),!0)}become(pc){return pc.length==this.length&&pc instanceof ac&&pc.side==this.side&&this.widget.constructor==pc.widget.constructor&&(this.widget.eq(pc.widget)||this.markDirty(!0),this.widget=pc.widget,!0)}ignoreMutation(){return!0}ignoreEvent(qc){return this.widget.ignoreEvent(qc)}get overrideDOMText(){if(0==this.length)return e.xv.empty;let rc=this;for(;rc.parent;)rc=rc.parent;let sc=rc.editorView,tc=sc&&sc.state.doc,uc=this.posAtStart;return tc?tc.slice(uc,uc+this.length):e.xv.empty}domAtPos(vc){return 0==vc?z.before(this.dom):z.after(this.dom,vc==this.length)}domBoundsAround(){return null}coordsAt(wc,xc){let yc=this.dom.getClientRects(),zc=null;if(!yc.length)return q;for(let Ac=wc>0?yc.length-1:0;zc=yc[Ac],wc>0?0!=Ac:Ac!=yc.length-1&&!(zc.top<zc.bottom);Ac+=wc>0?-1:1);return 0==wc&&xc>0||wc==this.length&&xc<=0?zc:r(zc,0==wc)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Bc extends ac{domAtPos(Cc){return new z(this.widget.text,Cc)}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(Dc,Ec){return Ec?3==Dc.nodeType?Math.min(Ec,this.length):this.length:0}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(Fc,Gc){return _b(this.widget.text,Fc,Gc)}get isEditable(){return!0}}class Hc extends I{constructor(Ic){super(),this.side=Ic}get length(){return 0}merge(){return!1}become(Jc){return Jc instanceof Hc&&Jc.side==this.side}split(){return new Hc(this.side)}sync(){if(!this.dom){let Kc=document.createElement("img");Kc.className="cm-widgetBuffer",this.setDOM(Kc)}}getSide(){return this.side}domAtPos(Lc){return z.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(Mc){return this.dom.getBoundingClientRect()}get overrideDOMText(){return e.xv.empty}}function Nc(a,b,c){let d=0;for(let e=0;d<b.length;d++){let f=b[d],g=e+f.length;if(!(g==e&&0>=f.getSide())){if(c>e&&c<g&&f.dom.parentNode==a)return f.domAtPos(c-e);if(c<=e)break;e=g}}for(;d>0;d--){let h=b[d-1].dom;if(h.parentNode==a)return z.after(h)}return new z(a,0)}function Oc(a,b,c){let d,{children:e}=a;c>0&&b instanceof Bb&&e.length&&(d=e[e.length-1])instanceof Bb&&d.mark.eq(b.mark)?Oc(d,b.children[0],c-1):(e.push(b),b.setParent(a)),a.length+=b.length}function Pc(a,b,c){for(let d=0,e=0;e<a.children.length;e++){let f=a.children[e],g=d+f.length,h;if((c<=0||g==a.length||f.getSide()>0?g>=b:g>b)&&(b<g||e+1==a.children.length||(h=a.children[e+1]).length||h.getSide()>0)){let i=0;if(g==d){if(0>=f.getSide())continue;i=c=-f.getSide()}let j=f.coordsAt(b-d,c);return i&&j?r(j,c<0):j}d=g}let k=a.dom.lastChild;if(!k)return a.dom.getBoundingClientRect();let m=l(k);return m[m.length-1]||null}function Qc(a,b){for(let c in a)"class"==c&&b.class?b.class+=" "+a.class:"style"==c&&b.style?b.style+=";"+a.style:b[c]=a[c];return b}function Rc(a,b){if(a==b)return!0;if(!a||!b)return!1;let c=Object.keys(a),d=Object.keys(b);if(c.length!=d.length)return!1;for(let e of c)if(-1==d.indexOf(e)||a[e]!==b[e])return!1;return!0}function Sc(a,b,c){if(b)for(let d in b)c&&d in c||a.removeAttribute(d);if(c)for(let e in c)b&&b[e]==c[e]||a.setAttribute(e,c[e])}jb.prototype.children=ac.prototype.children=Hc.prototype.children=H;class Tc{eq(Uc){return!1}updateDOM(Vc){return!1}compare(Wc){return this==Wc||this.constructor==Wc.constructor&&this.eq(Wc)}get estimatedHeight(){return -1}ignoreEvent(Xc){return!0}get customView(){return null}destroy(Yc){}}var Zc,$c=((Zc=$c||($c={}))[Zc.Text=0]="Text",Zc[Zc.WidgetBefore=1]="WidgetBefore",Zc[Zc.WidgetAfter=2]="WidgetAfter",Zc[Zc.WidgetRange=3]="WidgetRange",Zc);class _c extends g.uU{constructor(ad,bd,cd,dd){super(),this.startSide=ad,this.endSide=bd,this.widget=cd,this.spec=dd}get heightRelevant(){return!1}static mark(ed){return new pd(ed)}static widget(fd){let gd=fd.side||0,hd=!!fd.block;return gd+=hd?gd>0?30e7:-40e7:gd>0?10e7:-10e7,new Bd(fd,gd,gd,hd,fd.widget||null,!1)}static replace(id){let jd=!!id.block,{start:kd,end:ld}=Ld(id,jd);return new Bd(id,(kd?jd?-30e7:-1:40e7)-1,(ld?jd?20e7:1:-50e7)+1,jd,id.widget||null,!0)}static line(md){return new wd(md)}static set(nd,od=!1){return g.Xs.of(nd,od)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight> -1}}_c.none=g.Xs.empty;class pd extends _c{constructor(qd){let{start:rd,end:sd}=Ld(qd);super(rd?-1:40e7,sd?1:-50e7,null,qd),this.tagName=qd.tagName||"span",this.class=qd.class||"",this.attrs=qd.attributes||null}eq(td){return this==td||td instanceof pd&&this.tagName==td.tagName&&this.class==td.class&&Rc(this.attrs,td.attrs)}range(ud,vd=ud){if(ud>=vd)throw new RangeError("Mark decorations may not be empty");return super.range(ud,vd)}}pd.prototype.point=!1;class wd extends _c{constructor(xd){super(-20e7,-20e7,null,xd)}eq(yd){return yd instanceof wd&&Rc(this.spec.attributes,yd.spec.attributes)}range(zd,Ad=zd){if(Ad!=zd)throw new RangeError("Line decoration ranges must be zero-length");return super.range(zd,Ad)}}wd.prototype.mapMode=d.gc.TrackBefore,wd.prototype.point=!0;class Bd extends _c{constructor(Cd,Dd,Ed,Fd,Gd,Hd){super(Dd,Ed,Gd,Cd),this.block=Fd,this.isReplace=Hd,this.mapMode=Fd?Dd<=0?d.gc.TrackBefore:d.gc.TrackAfter:d.gc.TrackDel}get type(){return this.startSide<this.endSide?$c.WidgetRange:this.startSide<=0?$c.WidgetBefore:$c.WidgetAfter}get heightRelevant(){return this.block|| !!this.widget&&this.widget.estimatedHeight>=5}eq(Id){return Id instanceof Bd&&Md(this.widget,Id.widget)&&this.block==Id.block&&this.startSide==Id.startSide&&this.endSide==Id.endSide}range(Jd,Kd=Jd){if(this.isReplace&&(Jd>Kd||Jd==Kd&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&Kd!=Jd)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(Jd,Kd)}}function Ld(a,b=!1){let{inclusiveStart:c,inclusiveEnd:d}=a;return null==c&&(c=a.inclusive),null==d&&(d=a.inclusive),{start:null!=c?c:b,end:null!=d?d:b}}function Md(a,b){return a==b||!!(a&&b&&a.compare(b))}function Nd(a,b,c,d=0){let e=c.length-1;e>=0&&c[e]+d>=a?c[e]=Math.max(c[e],b):c.push(a,b)}Bd.prototype.point=!0;class Od extends I{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(Pd,Qd,Rd,Sd,Td,Ud){if(Rd){if(!(Rd instanceof Od))return!1;this.dom||Rd.transferDOM(this)}return Sd&&this.setDeco(Rd?Rd.attrs:null),Ya(this,Pd,Qd,Rd?Rd.children:[],Td,Ud),!0}split(Vd){let Wd=new Od;if(Wd.breakAfter=this.breakAfter,0==this.length)return Wd;let{i:Xd,off:Yd}=this.childPos(Vd);Yd&&(Wd.append(this.children[Xd].split(Yd),0),this.children[Xd].merge(Yd,this.children[Xd].length,null,!1,0,0),Xd++);for(let Zd=Xd;Zd<this.children.length;Zd++)Wd.append(this.children[Zd],0);for(;Xd>0&&0==this.children[Xd-1].length;)this.children[--Xd].destroy();return this.children.length=Xd,this.markDirty(),this.length=Vd,Wd}transferDOM($d){this.dom&&($d.setDOM(this.dom),$d.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(_d){Rc(this.attrs,_d)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=_d)}append(ae,be){Oc(this,ae,be)}addLineDeco(ce){let de=ce.spec.attributes,ee=ce.spec.class;de&&(this.attrs=Qc(de,this.attrs||{})),ee&&(this.attrs=Qc({class:ee},this.attrs||{}))}domAtPos(fe){return Nc(this.dom,this.children,fe)}reuseDOM(ge){"DIV"==ge.nodeName&&(this.setDOM(ge),this.dirty|=6)}sync(he){var ie;this.dom?4&this.dirty&&(y(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Sc(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(he);let je=this.dom.lastChild;for(;je&&I.get(je) instanceof Bb;)je=je.lastChild;if(!je||"BR"!=je.nodeName&&(null===(ie=I.get(je))|| void 0===ie?void 0:ie.isEditable)== !1&&(!ib.ios||!this.children.some(a=>a instanceof jb))){let ke=document.createElement("BR");ke.cmIgnore=!0,this.dom.appendChild(ke)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let le=0;for(let me of this.children){if(!(me instanceof jb))return null;let ne=l(me.dom);if(1!=ne.length)return null;le+=ne[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:le/this.length}}coordsAt(oe,pe){return Pc(this,oe,pe)}become(qe){return!1}get type(){return $c.Text}static find(re,se){for(let te=0,ue=0;te<re.children.length;te++){let ve=re.children[te],we=ue+ve.length;if(we>=se){if(ve instanceof Od)return ve;if(we>se)break}ue=we+ve.breakAfter}return null}}class xe extends I{constructor(ye,ze,Ae){super(),this.widget=ye,this.length=ze,this.type=Ae,this.breakAfter=0}merge(Be,Ce,De,Ee,Fe,Ge){return(!De||De instanceof xe&&!!this.widget.compare(De.widget)&&(!(Be>0)||!(Fe<=0))&&(!(Ce<this.length)||!(Ge<=0)))&&(this.length=Be+(De?De.length:0)+(this.length-Ce),!0)}domAtPos(He){return 0==He?z.before(this.dom):z.after(this.dom,He==this.length)}split(Ie){let Je=this.length-Ie;this.length=Ie;let Ke=new xe(this.widget,Je,this.type);return Ke.breakAfter=this.breakAfter,Ke}get children(){return H}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):e.xv.empty}domBoundsAround(){return null}become(Le){return Le instanceof xe&&Le.type==this.type&&Le.widget.constructor==this.widget.constructor&&(Le.widget.eq(this.widget)||this.markDirty(!0),this.widget=Le.widget,this.length=Le.length,this.breakAfter=Le.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(Me){return this.widget.ignoreEvent(Me)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ne{constructor(Oe,Pe,Qe,Re){this.doc=Oe,this.pos=Pe,this.end=Qe,this.disallowBlockEffectsBelow=Re,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=Oe.iter(),this.skip=Pe}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let Se=this.content[this.content.length-1];return!Se.breakAfter&&!(Se instanceof xe&&Se.type==$c.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Od),this.atCursorPos=!0),this.curLine}flushBuffer(Te){this.pendingBuffer&&(this.curLine.append(Bf(new Hc(-1),Te),Te.length),this.pendingBuffer=0)}addBlockWidget(Ue){this.flushBuffer([]),this.curLine=null,this.content.push(Ue)}finish(Ve){Ve?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(We,Xe,Ye){for(;We>0;){if(this.textOff==this.text.length){let{value:Ze,lineBreak:$e,done:_e}=this.cursor.next(this.skip);if(this.skip=0,_e)throw new Error("Ran out of text content when drawing inline views");if($e){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,We--;continue}this.text=Ze,this.textOff=0}let af=Math.min(this.text.length-this.textOff,We,512);this.flushBuffer(Xe.slice(0,Ye)),this.getLine().append(Bf(new jb(this.text.slice(this.textOff,this.textOff+af)),Xe),Ye),this.atCursorPos=!0,this.textOff+=af,We-=af,Ye=0}}span(bf,cf,df,ef){this.buildText(cf-bf,df,ef),this.pos=cf,this.openStart<0&&(this.openStart=ef)}point(ff,gf,hf,jf,kf){let lf=gf-ff;if(hf instanceof Bd)if(hf.block){let{type:mf}=hf;mf!=$c.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new xe(hf.widget||new Cf("div"),lf,mf))}else{let nf=ac.create(hf.widget||new Cf("span"),lf,hf.startSide),of=this.atCursorPos&&!nf.isEditable&&kf<=jf.length&&(ff<gf||hf.startSide>0),pf=!nf.isEditable&&(ff<gf||hf.startSide<=0),qf=this.getLine();2!=this.pendingBuffer||of||(this.pendingBuffer=0),this.flushBuffer(jf),of&&(qf.append(Bf(new Hc(1),jf),kf),kf=jf.length+Math.max(0,kf-jf.length)),qf.append(Bf(nf,jf),kf),this.atCursorPos=pf,this.pendingBuffer=pf?ff<gf?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(hf);lf&&(this.textOff+lf<=this.text.length?this.textOff+=lf:(this.skip+=lf-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=gf),this.openStart<0&&(this.openStart=kf)}filterPoint(rf,sf,tf,uf){if(uf<this.disallowBlockEffectsBelow&&tf instanceof Bd){if(tf.block)throw new RangeError("Block decorations may not be specified via plugins");if(sf>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(vf,wf,xf,yf,zf){let Af=new Ne(vf,wf,xf,zf);return Af.openEnd=g.Xs.spans(yf,wf,xf,Af),Af.openStart<0&&(Af.openStart=Af.openEnd),Af.finish(Af.openEnd),Af}}function Bf(a,b){for(let c of b)a=new Bb(c,[a],a.length);return a}class Cf extends Tc{constructor(Df){super(),this.tag=Df}eq(Ef){return Ef.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(Ff){return Ff.nodeName.toLowerCase()==this.tag}}const Gf=d.r$.define(),Hf=d.r$.define(),If=d.r$.define(),Jf=d.r$.define(),Kf=d.r$.define(),Lf=d.r$.define(),Mf=d.Py.define({map:(a,b)=>a.map(b)}),Nf=d.Py.define({map:(a,b)=>a.map(b)});class Of{constructor(Pf,Qf="nearest",Rf="nearest",Sf=5,Tf=5){this.range=Pf,this.y=Qf,this.x=Rf,this.yMargin=Sf,this.xMargin=Tf}map(Uf){return Uf.empty?this:new Of(this.range.map(Uf),this.y,this.x,this.yMargin,this.xMargin)}}const Vf=d.Py.define({map:(a,b)=>a.map(b)});function Wf(a,b,c){let d=a.facet(Jf);d.length?d[0](b):window.onerror?window.onerror(String(b),c,void 0,void 0,b):c?console.error(c+":",b):console.error(b)}const Xf=d.r$.define({combine:a=>!a.length||a[0]});class Yf{constructor(Zf,$f){this.field=Zf,this.get=$f}}class _f{from(ag){return new Yf(this,ag)}static define(){return new _f()}}_f.decorations=_f.define(),_f.atomicRanges=_f.define(),_f.scrollMargins=_f.define();let bg=0;const cg=d.r$.define();class dg{constructor(eg,fg,gg){this.id=eg,this.create=fg,this.fields=gg,this.extension=cg.of(this)}static define(hg,ig){let{eventHandlers:jg,provide:kg,decorations:lg}=ig||{},mg=[];if(kg)for(let ng of Array.isArray(kg)?kg:[kg])mg.push(ng);return jg&&mg.push(qg.from(a=>({plugin:a,handlers:jg}))),lg&&mg.push(_f.decorations.from(lg)),new dg(bg++,hg,mg)}static fromClass(og,pg){return dg.define(a=>new og(a),pg)}}const qg=_f.define();class rg{constructor(sg){this.spec=sg,this.mustUpdate=null,this.value=null}takeField(tg,ug){if(this.spec)for(let{field:vg,get:wg}of this.spec.fields)vg==tg&&ug.push(wg(this.value))}update(xg){if(this.value){if(this.mustUpdate){let yg=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(yg)}catch(zg){if(Wf(yg.state,zg,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(Ag){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(xg)}catch(Bg){Wf(xg.state,Bg,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(Cg){var Dg;if(null===(Dg=this.value)|| void 0===Dg?void 0:Dg.destroy)try{this.value.destroy()}catch(Eg){Wf(Cg.state,Eg,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Fg=d.r$.define(),Gg=d.r$.define(),Hg=d.r$.define(),Ig=d.r$.define();class Jg{constructor(Kg,Lg,Mg,Ng){this.fromA=Kg,this.toA=Lg,this.fromB=Mg,this.toB=Ng}join(Og){return new Jg(Math.min(this.fromA,Og.fromA),Math.max(this.toA,Og.toA),Math.min(this.fromB,Og.fromB),Math.max(this.toB,Og.toB))}addToSet(Pg){let Qg=Pg.length,Rg=this;for(;Qg>0;Qg--){let Sg=Pg[Qg-1];if(!(Sg.fromA>Rg.toA)){if(Sg.toA<Rg.fromA)break;Rg=Rg.join(Sg),Pg.splice(Qg-1,1)}}return Pg.splice(Qg,0,Rg),Pg}static extendWithRanges(Tg,Ug){if(0==Ug.length)return Tg;let Vg=[];for(let Wg=0,Xg=0,Yg=0,Zg=0;;Wg++){let $g=Wg==Tg.length?null:Tg[Wg],_g=Yg-Zg,ah=$g?$g.fromB:10e8;for(;Xg<Ug.length&&Ug[Xg]<ah;){let bh=Ug[Xg],ch=Ug[Xg+1],dh=Math.max(Zg,bh),eh=Math.min(ah,ch);if(dh<=eh&&new Jg(dh+_g,eh+_g,dh,eh).addToSet(Vg),ch>ah)break;Xg+=2}if(!$g)return Vg;new Jg($g.fromA,$g.toA,$g.fromB,$g.toB).addToSet(Vg),Yg=$g.toA,Zg=$g.toB}}}class fh{constructor(gh,hh,ih=[]){for(let jh of(this.view=gh,this.state=hh,this.transactions=ih,this.flags=0,this.startState=gh.state,this.changes=d.as.empty(this.startState.doc.length),ih))this.changes=this.changes.compose(jh.changes);let kh=[];this.changes.iterChangedRanges((a,b,c,d)=>kh.push(new Jg(a,b,c,d))),this.changedRanges=kh;let lh=gh.hasFocus;lh!=gh.inputState.notifiedFocused&&(gh.inputState.notifiedFocused=lh,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(a=>a.selection)}get empty(){return 0==this.flags&&0==this.transactions.length}}var mh,nh=((mh=nh||(nh={}))[mh.LTR=0]="LTR",mh[mh.RTL=1]="RTL",mh);const oh=nh.LTR,ph=nh.RTL;function qh(a){let b=[];for(let c=0;c<a.length;c++)b.push(1<< +a[c]);return b}const rh=qh("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),sh=qh("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),th=Object.create(null),uh=[];for(let vh of["()","[]","{}"]){let wh=vh.charCodeAt(0),xh=vh.charCodeAt(1);th[wh]=xh,th[xh]=-wh}function yh(a){return a<=247?rh[a]:1424<=a&&a<=1524?2:1536<=a&&a<=1785?sh[a-1536]:1774<=a&&a<=2220?4:8192<=a&&a<=8203?256:8204==a?256:1}const zh=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Ah{constructor(Bh,Ch,Dh){this.from=Bh,this.to=Ch,this.level=Dh}get dir(){return this.level%2?ph:oh}side(Eh,Fh){return this.dir==Fh==Eh?this.to:this.from}static find(Gh,Hh,Ih,Jh){let Kh=-1;for(let Lh=0;Lh<Gh.length;Lh++){let Mh=Gh[Lh];if(Mh.from<=Hh&&Mh.to>=Hh){if(Mh.level==Ih)return Lh;(Kh<0||(0!=Jh?Jh<0?Mh.from<Hh:Mh.to>Hh:Gh[Kh].level>Mh.level))&&(Kh=Lh)}}if(Kh<0)throw new RangeError("Index out of range");return Kh}}const Nh=[];function Oh(a){return[new Ah(0,a,0)]}let Ph="";function Qh(a,b,c,f,g){var h;let i=f.head-a.from,j=-1;if(0==i){if(!g||!a.length)return null;b[0].level!=c&&(i=b[0].side(!1,c),j=0)}else if(i==a.length){if(g)return null;let k=b[b.length-1];k.level!=c&&(i=k.side(!0,c),j=b.length-1)}j<0&&(j=Ah.find(b,i,null!==(h=f.bidiLevel)&& void 0!==h?h:-1,f.assoc));let l=b[j];i==l.side(g,c)&&(i=(l=b[j+=g?1:-1]).side(!g,c));let m=g==(l.dir==c),n=(0,e.cp)(a.text,i,m);if(Ph=a.text.slice(Math.min(i,n),Math.max(i,n)),n!=l.side(g,c))return d.jT.cursor(n+a.from,m?-1:1,l.level);let o=j==(g?b.length-1:0)?null:b[j+(g?1:-1)];return o||l.level==c?o&&o.level<l.level?d.jT.cursor(o.side(!g,c)+a.from,g?1:-1,o.level):d.jT.cursor(n+a.from,g?-1:1,l.level):d.jT.cursor(g?a.to:a.from,g?-1:1,c)}class Rh{constructor(Sh,Th){this.points=Sh,this.text="",this.lineSeparator=Th.facet(d.yy.lineSeparator)}append(Uh){this.text+=Uh}lineBreak(){this.text+="￿"}readRange(Vh,Wh){if(!Vh)return this;let Xh=Vh.parentNode;for(let Yh=Vh;;){this.findPointBefore(Xh,Yh),this.readNode(Yh);let Zh=Yh.nextSibling;if(Zh==Wh)break;let $h=I.get(Yh),_h=I.get(Zh);($h&&_h?$h.breakAfter:($h?$h.breakAfter:ti(Yh))||ti(Zh)&&("BR"!=Yh.nodeName||Yh.cmIgnore))&&this.lineBreak(),Yh=Zh}return this.findPointBefore(Xh,Wh),this}readTextNode(ai){let bi=ai.nodeValue;for(let ci of this.points)ci.node==ai&&(ci.pos=this.text.length+Math.min(ci.offset,bi.length));for(let di=0,ei=this.lineSeparator?null:/\r\n?|\n/g;;){let fi=-1,gi=1,hi;if(this.lineSeparator?(fi=bi.indexOf(this.lineSeparator,di),gi=this.lineSeparator.length):(hi=ei.exec(bi))&&(fi=hi.index,gi=hi[0].length),this.append(bi.slice(di,fi<0?bi.length:fi)),fi<0)break;if(this.lineBreak(),gi>1)for(let ii of this.points)ii.node==ai&&ii.pos>this.text.length&&(ii.pos-=gi-1);di=fi+gi}}readNode(ji){if(ji.cmIgnore)return;let ki=I.get(ji),li=ki&&ki.overrideDOMText;if(null!=li){this.findPointInside(ji,li.length);for(let mi=li.iter();!mi.next().done;)mi.lineBreak?this.lineBreak():this.append(mi.value)}else 3==ji.nodeType?this.readTextNode(ji):"BR"==ji.nodeName?ji.nextSibling&&this.lineBreak():1==ji.nodeType&&this.readRange(ji.firstChild,null)}findPointBefore(ni,oi){for(let pi of this.points)pi.node==ni&&ni.childNodes[pi.offset]==oi&&(pi.pos=this.text.length)}findPointInside(qi,ri){for(let si of this.points)(3==qi.nodeType?si.node==qi:qi.contains(si.node))&&(si.pos=this.text.length+Math.min(ri,si.offset))}}function ti(a){return 1==a.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(a.nodeName)}class ui{constructor(vi,wi){this.node=vi,this.offset=wi,this.pos=-1}}class xi extends I{constructor(yi){super(),this.view=yi,this.compositionDeco=_c.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(yi.contentDOM),this.children=[new Od],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Jg(0,0,0,yi.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(zi){let Ai=zi.changedRanges;this.minWidth>0&&Ai.length&&(Ai.every(({fromA:a,toA:b})=>b<this.minWidthFrom||a>this.minWidthTo)?(this.minWidthFrom=zi.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=zi.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=_c.none:(zi.transactions.length||this.dirty)&&(this.compositionDeco=yk(this.view,zi.changes)),(ib.ie||ib.chrome)&&!this.compositionDeco.size&&zi&&zi.state.doc.lines!=zi.startState.doc.lines&&(this.forceSelection=!0);let Bi=Kk(this.decorations,this.updateDeco(),zi.changes);return Ai=Jg.extendWithRanges(Ai,Bi),(0!=this.dirty||0!=Ai.length)&&(this.updateInner(Ai,zi.startState.doc.length),zi.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(Ci,Di){this.view.viewState.mustMeasureContent=!0,this.updateChildren(Ci,Di);let{observer:Ei}=this.view;Ei.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let a=ib.chrome||ib.ios?{node:Ei.selectionRange.focusNode,written:!1}:void 0;this.sync(a),this.dirty=0,a&&(a.written||Ei.selectionRange.focusNode!=a.node)&&(this.forceSelection=!0),this.dom.style.height=""});let Fi=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let Gi of this.children)Gi instanceof xe&&Gi.widget instanceof sk&&Fi.push(Gi.dom);Ei.updateGaps(Fi)}updateChildren(Hi,Ii){let Ji=this.childCursor(Ii);for(let Ki=Hi.length-1;;Ki--){let Li=Ki>=0?Hi[Ki]:null;if(!Li)break;let{fromA:Mi,toA:Ni,fromB:Oi,toB:Pi}=Li,{content:Qi,breakAtStart:Ri,openStart:Si,openEnd:Ti}=Ne.build(this.view.state.doc,Oi,Pi,this.decorations,this.pluginDecorationLength),{i:Ui,off:Vi}=Ji.findPos(Ni,1),{i:Wi,off:Xi}=Ji.findPos(Mi,-1);Xa(this,Wi,Xi,Ui,Vi,Qi,Ri,Si,Ti)}}updateSelection(Yi=!1,Zi=!1){if(Yi&&this.view.observer.readSelectionRange(),!(Zi||this.mayControlSelection())||ib.ios&&this.view.inputState.rapidCompositionStart)return;let $i=this.forceSelection;this.forceSelection=!1;let _i=this.view.state.selection.main,aj=this.domAtPos(_i.anchor),bj=_i.empty?aj:this.domAtPos(_i.head);if(ib.gecko&&_i.empty&&rk(aj)){let cj=document.createTextNode("");this.view.observer.ignore(()=>aj.node.insertBefore(cj,aj.node.childNodes[aj.offset]||null)),aj=bj=new z(cj,0),$i=!0}let dj=this.view.observer.selectionRange;!$i&&dj.focusNode&&m(aj.node,aj.offset,dj.anchorNode,dj.anchorOffset)&&m(bj.node,bj.offset,dj.focusNode,dj.focusOffset)||(this.view.observer.ignore(()=>{ib.android&&ib.chrome&&this.dom.contains(dj.focusNode)&&Lk(dj.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let a=i(this.root);if(_i.empty){if(ib.gecko){let b=Ek(aj.node,aj.offset);if(b&&3!=b){let c=Dk(aj.node,aj.offset,1==b?1:-1);c&&(aj=new z(c,1==b?0:c.nodeValue.length))}}a.collapse(aj.node,aj.offset),null!=_i.bidiLevel&&null!=dj.cursorBidiLevel&&(dj.cursorBidiLevel=_i.bidiLevel)}else if(a.extend)a.collapse(aj.node,aj.offset),a.extend(bj.node,bj.offset);else{let d=document.createRange();_i.anchor>_i.head&&([aj,bj]=[bj,aj]),d.setEnd(bj.node,bj.offset),d.setStart(aj.node,aj.offset),a.removeAllRanges(),a.addRange(d)}}),this.view.observer.setSelectionRange(aj,bj)),this.impreciseAnchor=aj.precise?null:new z(dj.anchorNode,dj.anchorOffset),this.impreciseHead=bj.precise?null:new z(dj.focusNode,dj.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let ej=this.view.state.selection.main,fj=i(this.root);if(!ej.empty||!ej.assoc||!fj.modify)return;let gj=Od.find(this,ej.head);if(!gj)return;let hj=gj.posAtStart;if(ej.head==hj||ej.head==hj+gj.length)return;let ij=this.coordsAt(ej.head,-1),jj=this.coordsAt(ej.head,1);if(!ij||!jj||ij.bottom>jj.top)return;let kj=this.domAtPos(ej.head+ej.assoc);fj.collapse(kj.node,kj.offset),fj.modify("move",ej.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Xf)?this.root.activeElement==this.dom:k(this.dom,this.view.observer.selectionRange)}nearest(lj){for(let mj=lj;mj;){let nj=I.get(mj);if(nj&&nj.rootView==this)return nj;mj=mj.parentNode}return null}posFromDOM(oj,pj){let qj=this.nearest(oj);if(!qj)throw new RangeError("Trying to find position for a DOM position outside of the document");return qj.localPosFromDOM(oj,pj)+qj.posAtStart}domAtPos(rj){let{i:sj,off:tj}=this.childCursor().findPos(rj,-1);for(;sj<this.children.length-1;){let uj=this.children[sj];if(tj<uj.length||uj instanceof Od)break;sj++,tj=0}return this.children[sj].domAtPos(tj)}coordsAt(vj,wj){for(let xj=this.length,yj=this.children.length-1;;yj--){let zj=this.children[yj],Aj=xj-zj.breakAfter-zj.length;if(vj>Aj||vj==Aj&&zj.type!=$c.WidgetBefore&&zj.type!=$c.WidgetAfter&&(!yj||2==wj||this.children[yj-1].breakAfter||this.children[yj-1].type==$c.WidgetBefore&&wj> -2))return zj.coordsAt(vj-Aj,wj);xj=Aj}}measureVisibleLineHeights(){let Bj=[],{from:Cj,to:Dj}=this.view.viewState.viewport,Ej=this.view.contentDOM.clientWidth,Fj=Ej>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,Gj=-1;for(let Hj=0,Ij=0;Ij<this.children.length;Ij++){let Jj=this.children[Ij],Kj=Hj+Jj.length;if(Kj>Dj)break;if(Hj>=Cj){let Lj=Jj.dom.getBoundingClientRect();if(Bj.push(Lj.height),Fj){let Mj=Jj.dom.lastChild,Nj=Mj?l(Mj):[];if(Nj.length){let Oj=Nj[Nj.length-1],Pj=this.view.textDirection==nh.LTR?Oj.right-Lj.left:Lj.right-Oj.left;Pj>Gj&&(Gj=Pj,this.minWidth=Ej,this.minWidthFrom=Hj,this.minWidthTo=Kj)}}}Hj=Kj+Jj.breakAfter}return Bj}measureTextSize(){for(let Qj of this.children)if(Qj instanceof Od){let Rj=Qj.measureTextSize();if(Rj)return Rj}let Sj=document.createElement("div"),Tj,Uj;return Sj.className="cm-line",Sj.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(Sj);let a=l(Sj.firstChild)[0];Tj=Sj.getBoundingClientRect().height,Uj=a?a.width/27:7,Sj.remove()}),{lineHeight:Tj,charWidth:Uj}}childCursor(Vj=this.length){let Wj=this.children.length;return Wj&&(Vj-=this.children[--Wj].length),new Qa(this.children,Vj,Wj)}computeBlockGapDeco(){let Xj=[],Yj=this.view.viewState;for(let Zj=0,$j=0;;$j++){let _j=$j==Yj.viewports.length?null:Yj.viewports[$j],ak=_j?_j.from-1:this.length;if(ak>Zj){let bk=Yj.lineBlockAt(ak).bottom-Yj.lineBlockAt(Zj).top;Xj.push(_c.replace({widget:new sk(bk),block:!0,inclusive:!0}).range(Zj,ak))}if(!_j)break;Zj=_j.to+1}return _c.set(Xj)}updateDeco(){let ck=this.view.pluginField(_f.decorations);return this.pluginDecorationLength=ck.length,this.decorations=[...ck,...this.view.state.facet(Hg),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(dk){let{range:ek}=dk,fk=this.coordsAt(ek.head,ek.empty?ek.assoc:ek.head>ek.anchor?-1:1),gk;if(!fk)return;!ek.empty&&(gk=this.coordsAt(ek.anchor,ek.anchor>ek.head?-1:1))&&(fk={left:Math.min(fk.left,gk.left),top:Math.min(fk.top,gk.top),right:Math.max(fk.right,gk.right),bottom:Math.max(fk.bottom,gk.bottom)});let hk=0,ik=0,jk=0,kk=0;for(let lk of this.view.pluginField(_f.scrollMargins))if(lk){let{left:mk,right:nk,top:ok,bottom:pk}=lk;null!=mk&&(hk=Math.max(hk,mk)),null!=nk&&(ik=Math.max(ik,nk)),null!=ok&&(jk=Math.max(jk,ok)),null!=pk&&(kk=Math.max(kk,pk))}let qk={left:fk.left-hk,top:fk.top-jk,right:fk.right+ik,bottom:fk.bottom+kk};!function(a,b,c,d,e,f,g,h){let i=a.ownerDocument,j=i.defaultView;for(let k=a;k;)if(1==k.nodeType){let l,m=k==i.body;if(m)l=s(j);else{if(k.scrollHeight<=k.clientHeight&&k.scrollWidth<=k.clientWidth){k=k.parentNode;continue}let n=k.getBoundingClientRect();l={left:n.left,right:n.left+k.clientWidth,top:n.top,bottom:n.top+k.clientHeight}}let o=0,p=0;if("nearest"==e)b.top<l.top?(p=-(l.top-b.top+g),c>0&&b.bottom>l.bottom+p&&(p=b.bottom-l.bottom+p+g)):b.bottom>l.bottom&&(p=b.bottom-l.bottom+g,c<0&&b.top-p<l.top&&(p=-(l.top+p-b.top+g)));else{let q=b.bottom-b.top,r=l.bottom-l.top;p=("center"==e&&q<=r?b.top+q/2-r/2:"start"==e||"center"==e&&c<0?b.top-g:b.bottom-r+g)-l.top}if("nearest"==d?b.left<l.left?(o=-(l.left-b.left+f),c>0&&b.right>l.right+o&&(o=b.right-l.right+o+f)):b.right>l.right&&(o=b.right-l.right+f,c<0&&b.left<l.left+o&&(o=-(l.left+o-b.left+f))):o=("center"==d?b.left+(b.right-b.left)/2-(l.right-l.left)/2:"start"==d==h?b.left-f:b.right-(l.right-l.left)+f)-l.left,o||p)if(m)j.scrollBy(o,p);else{if(p){let t=k.scrollTop;k.scrollTop+=p,p=k.scrollTop-t}if(o){let u=k.scrollLeft;k.scrollLeft+=o,o=k.scrollLeft-u}b={left:b.left-o,top:b.top-p,right:b.right-o,bottom:b.bottom-p}}if(m)break;k=k.assignedSlot||k.parentNode,d=e="nearest"}else if(11==k.nodeType)k=k.host;else break}(this.view.scrollDOM,qk,ek.head<ek.anchor?-1:1,dk.x,dk.y,dk.xMargin,dk.yMargin,this.view.textDirection==nh.LTR)}}function rk(a){return 1==a.node.nodeType&&a.node.firstChild&&(0==a.offset||"false"==a.node.childNodes[a.offset-1].contentEditable)&&(a.offset==a.node.childNodes.length||"false"==a.node.childNodes[a.offset].contentEditable)}class sk extends Tc{constructor(tk){super(),this.height=tk}toDOM(){let uk=document.createElement("div");return this.updateDOM(uk),uk}eq(vk){return vk.height==this.height}updateDOM(wk){return wk.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function xk(a){let b=a.observer.selectionRange,c=b.focusNode&&Dk(b.focusNode,b.focusOffset,0);if(!c)return null;let d=a.docView.nearest(c);if(!d)return null;if(d instanceof Od){let e=c;for(;e.parentNode!=d.dom;)e=e.parentNode;let f=e.previousSibling;for(;f&&!I.get(f);)f=f.previousSibling;let g=f?I.get(f).posAtEnd:d.posAtStart;return{from:g,to:g,node:e,text:c}}{for(;;){let{parent:h}=d;if(!h)return null;if(h instanceof Od)break;d=h}let i=d.posAtStart;return{from:i,to:i+d.length,node:d.dom,text:c}}}function yk(a,b){let c=xk(a);if(!c)return _c.none;let{from:d,to:e,node:f,text:g}=c,h=b.mapPos(d,1),i=Math.max(h,b.mapPos(e,-1)),{state:j}=a,k=3==f.nodeType?f.nodeValue:new Rh([],j).readRange(f.firstChild,null).text;if(i-h<k.length)if(j.doc.sliceString(h,Math.min(j.doc.length,h+k.length),"￿")==k)i=h+k.length;else{if(j.doc.sliceString(Math.max(0,i-k.length),i,"￿")!=k)return _c.none;h=i-k.length}else if(j.doc.sliceString(h,i,"￿")!=k)return _c.none;return _c.set(_c.replace({widget:new zk(f,g)}).range(h,i))}class zk extends Tc{constructor(Ak,Bk){super(),this.top=Ak,this.text=Bk}eq(Ck){return this.top==Ck.top&&this.text==Ck.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Bc}}function Dk(a,b,c){for(;;){if(3==a.nodeType)return a;if(1==a.nodeType&&b>0&&c<=0)b=p(a=a.childNodes[b-1]);else{if(1!=a.nodeType||!(b<a.childNodes.length)||!(c>=0))return null;a=a.childNodes[b],b=0}}}function Ek(a,b){return 1!=a.nodeType?0:(b&&"false"==a.childNodes[b-1].contentEditable?1:0)|(b<a.childNodes.length&&"false"==a.childNodes[b].contentEditable?2:0)}class Fk{constructor(){this.changes=[]}compareRange(Gk,Hk){Nd(Gk,Hk,this.changes)}comparePoint(Ik,Jk){Nd(Ik,Jk,this.changes)}}function Kk(a,b,c){let d=new Fk;return g.Xs.compare(a,b,c,d),d.changes}function Lk(a,b){for(let c=a;c&&c!=b;c=c.assignedSlot||c.parentNode)if(1==c.nodeType&&"false"==c.contentEditable)return!0;return!1}function Mk(a,b){return b.left>a?b.left-a:Math.max(0,a-b.right)}function Nk(a,b){return b.top>a?b.top-a:Math.max(0,a-b.bottom)}function Ok(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1}function Pk(a,b){return b<a.top?{top:b,left:a.left,right:a.right,bottom:a.bottom}:a}function Qk(a,b){return b>a.bottom?{top:a.top,left:a.left,right:a.right,bottom:b}:a}function Rk(a,b,c){let d,e,f,g,h,i,j,k;for(let m=a.firstChild;m;m=m.nextSibling){let n=l(m);for(let o=0;o<n.length;o++){let p=n[o];e&&Ok(e,p)&&(p=Pk(Qk(p,e.bottom),e.top));let q=Mk(b,p),r=Nk(c,p);if(0==q&&0==r)return 3==m.nodeType?Sk(m,b,c):Rk(m,b,c);(!d||g>r||g==r&&f>q)&&(d=m,e=p,f=q,g=r),0==q?c>p.bottom&&(!j||j.bottom<p.bottom)?(h=m,j=p):c<p.top&&(!k||k.top>p.top)&&(i=m,k=p):j&&Ok(j,p)?j=Qk(j,p.bottom):k&&Ok(k,p)&&(k=Pk(k,p.top))}}if(j&&j.bottom>=c?(d=h,e=j):k&&k.top<=c&&(d=i,e=k),!d)return{node:a,offset:0};let s=Math.max(e.left,Math.min(e.right,b));if(3==d.nodeType)return Sk(d,s,c);if(!f&&"true"==d.contentEditable)return Rk(d,s,c);let t=Array.prototype.indexOf.call(a.childNodes,d)+(b>=(e.left+e.right)/2?1:0);return{node:a,offset:t}}function Sk(a,b,c){let d=a.nodeValue.length,e=-1,f=10e8,g=0;for(let h=0;h<d;h++){let i=w(a,h,h+1).getClientRects();for(let j=0;j<i.length;j++){let k=i[j];if(k.top==k.bottom)continue;g||(g=b-k.left);let l=(k.top>c?k.top-c:c-k.bottom)-1;if(k.left-1<=b&&k.right+1>=b&&l<f){let m=b>=(k.left+k.right)/2,n=m;if((ib.chrome||ib.gecko)&&w(a,h).getBoundingClientRect().left==k.right&&(n=!m),l<=0)return{node:a,offset:h+(n?1:0)};e=h+(n?1:0),f=l}}}return{node:a,offset:e> -1?e:g>0?a.nodeValue.length:0}}function Tk(a,{x:b,y:c},d,e=-1){var f;let g=a.contentDOM.getBoundingClientRect(),h=g.top+a.viewState.paddingTop,i,{docHeight:j}=a.viewState,k=c-h;if(k<0)return 0;if(k>j)return a.state.doc.length;for(let l=a.defaultLineHeight/2,m=!1;;){if((i=a.elementAtHeight(k)).type==$c.Text)break;for(;;){if((k=e>0?i.bottom+l:i.top-l)>=0&&k<=j)break;if(m)return d?null:0;m=!0,e=-e}}c=h+k;let n=i.from;if(n<a.viewport.from)return 0==a.viewport.from?0:d?null:Uk(a,g,i,b,c);if(n>a.viewport.to)return a.viewport.to==a.state.doc.length?a.state.doc.length:d?null:Uk(a,g,i,b,c);let o=a.dom.ownerDocument,p=a.root.elementFromPoint?a.root:o,q=p.elementFromPoint(b,c);q&&!a.contentDOM.contains(q)&&(q=null),!q&&(b=Math.max(g.left+1,Math.min(g.right-1,b)),(q=p.elementFromPoint(b,c))&&!a.contentDOM.contains(q)&&(q=null));let r,s=-1;if(q&&(null===(f=a.docView.nearest(q))|| void 0===f?void 0:f.isEditable)!= !1){if(o.caretPositionFromPoint){let t=o.caretPositionFromPoint(b,c);t&&({offsetNode:r,offset:s}=t)}else if(o.caretRangeFromPoint){let u=o.caretRangeFromPoint(b,c);u&&({startContainer:r,startOffset:s}=u,ib.safari&&Vk(r,s,b)&&(r=void 0))}}if(!r||!a.docView.dom.contains(r)){let v=Od.find(a.docView,n);if(!v)return k>i.top+i.height/2?i.to:i.from;({node:r,offset:s}=Rk(v.dom,b,c))}return a.docView.posFromDOM(r,s)}function Uk(a,b,c,d,f){let g=Math.round((d-b.left)*a.defaultCharacterWidth);a.lineWrapping&&c.height>1.5*a.defaultLineHeight&&(g+=Math.floor((f-c.top)/a.defaultLineHeight)*a.viewState.heightOracle.lineLength);let h=a.state.sliceDoc(c.from,c.to);return c.from+(0,e.Gz)(h,g,a.state.tabSize)}function Vk(a,b,c){let d;if(3!=a.nodeType||b!=(d=a.nodeValue.length))return!1;for(let e=a.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return w(a,d-1,d).getBoundingClientRect().left>c}function Wk(a,b,c,e){let f=a.state.doc.lineAt(b.head),g=a.bidiSpans(f);for(let h=b,i=null;;){let j=Qh(f,g,a.textDirection,h,c),k=Ph;if(!j){if(f.number==(c?a.state.doc.lines:1))return h;k="\n",f=a.state.doc.line(f.number+(c?1:-1)),g=a.bidiSpans(f),j=d.jT.cursor(c?f.from:f.to)}if(i){if(!i(k))return h}else{if(!e)return j;i=e(k)}h=j}}function Xk(a,b,c){let e=a.pluginField(_f.atomicRanges);for(;;){let f=!1;for(let g of e)g.between(c.from-1,c.from+1,(a,e,g)=>{c.from>a&&c.from<e&&(c=b.from>c.from?d.jT.cursor(a,1):d.jT.cursor(e,-1),f=!0)});if(!f)return c}}const Yk=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Zk=[16,17,18,20,91,92,224,225];class $k{constructor(_k,al,bl,cl){var dl,el,fl,gl;this.view=_k,this.style=bl,this.mustSelect=cl,this.lastEvent=al;let hl=_k.contentDOM.ownerDocument,il,jl;hl.addEventListener("mousemove",this.move=this.move.bind(this)),hl.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=al.shiftKey,this.multiple=_k.state.facet(d.yy.allowMultipleSelections)&&(dl=_k,el=al,(il=dl.state.facet(Gf)).length?il[0](el):ib.mac?el.metaKey:el.ctrlKey),fl=_k,gl=al,jl=fl.state.facet(Hf),this.dragMove=jl.length?jl[0](gl):ib.mac?!gl.altKey:!gl.ctrlKey,this.dragging=!!function(a,b){let{main:c}=a.state.selection;if(c.empty)return!1;let d=i(a.root);if(0==d.rangeCount)return!0;let e=d.getRangeAt(0).getClientRects();for(let f=0;f<e.length;f++){let g=e[f];if(g.left<=b.clientX&&g.right>=b.clientX&&g.top<=b.clientY&&g.bottom>=b.clientY)return!0}return!1}(_k,al)&&1==Dl(al)&&null,!1===this.dragging&&(al.preventDefault(),this.select(al))}move(kl){if(0==kl.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=kl)}up(ll){null==this.dragging&&this.select(this.lastEvent),this.dragging||ll.preventDefault(),this.destroy()}destroy(){let ml=this.view.contentDOM.ownerDocument;ml.removeEventListener("mousemove",this.move),ml.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(nl){let ol=this.style.get(nl,this.extend,this.multiple);(this.mustSelect||!ol.eq(this.view.state.selection)||ol.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:ol,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(pl){pl.docChanged&&this.dragging&&(this.dragging=this.dragging.map(pl.changes)),this.style.update(pl)&&setTimeout(()=>this.select(this.lastEvent),20)}}function ql(a,b){if(!b.bubbles)return!0;if(b.defaultPrevented)return!1;for(let c=b.target,d;c!=a.contentDOM;c=c.parentNode)if(!c||11==c.nodeType||(d=I.get(c))&&d.ignoreEvent(b))return!1;return!0}const rl=Object.create(null),sl=ib.ie&&ib.ie_version<15||ib.ios&&ib.webkit_version<604;function tl(a,b){let{state:c}=a,e,f=1,g=c.toText(b),h=g.lines==c.selection.ranges.length;if(null!=Gl&&c.selection.ranges.every(a=>a.empty)&&Gl==g.toString()){let i=-1;e=c.changeByRange(a=>{let e=c.doc.lineAt(a.from);if(e.from==i)return{range:a};i=e.from;let j=c.toText((h?g.line(f++).text:b)+c.lineBreak);return{changes:{from:e.from,insert:j},range:d.jT.cursor(a.from+j.length)}})}else e=h?c.changeByRange(a=>{let b=g.line(f++);return{changes:{from:a.from,to:a.to,insert:b.text},range:d.jT.cursor(a.from+b.length)}}):c.replaceSelection(g);a.dispatch(e,{userEvent:"input.paste",scrollIntoView:!0})}rl.keydown=(a,b)=>{a.inputState.setSelectionOrigin("select")};let ul=0;function vl(a,b,c,f){if(1==f)return d.jT.cursor(b,c);{if(2==f)return(function(a,b,c=1){let f=a.charCategorizer(b),g=a.doc.lineAt(b),h=b-g.from;if(0==g.length)return d.jT.cursor(b);0==h?c=1:h==g.length&&(c=-1);let i=h,j=h;c<0?i=(0,e.cp)(g.text,h,!1):j=(0,e.cp)(g.text,h);let k=f(g.text.slice(i,j));for(;i>0;){let l=(0,e.cp)(g.text,i,!1);if(f(g.text.slice(l,i))!=k)break;i=l}for(;j<g.length;){let m=(0,e.cp)(g.text,j);if(f(g.text.slice(j,m))!=k)break;j=m}return d.jT.range(i+g.from,j+g.from)})(a.state,b,c);let g=Od.find(a.docView,b),h=a.state.doc.lineAt(g?g.posAtEnd:b),i=g?g.posAtStart:h.from,j=g?g.posAtEnd:h.to;return j<a.state.doc.length&&j==h.to&&j++,d.jT.range(i,j)}}rl.touchstart=(a,b)=>{ul=Date.now(),a.inputState.setSelectionOrigin("select.pointer")},rl.touchmove=a=>{a.inputState.setSelectionOrigin("select.pointer")},rl.mousedown=(a,b)=>{if(a.observer.flush(),ul>Date.now()-2000&&1==Dl(b))return;let c=null;for(let d of a.state.facet(If))if(c=d(a,b))break;if(c||0!=b.button||(c=El(a,b)),c){let e=a.root.activeElement!=a.contentDOM;e&&a.observer.ignore(()=>u(a.contentDOM)),a.inputState.startMouseSelection(new $k(a,b,c,e))}};let wl=(a,b)=>a>=b.top&&a<=b.bottom,xl=(a,b,c)=>wl(b,c)&&a>=c.left&&a<=c.right;function yl(a,b){let c=a.posAtCoords({x:b.clientX,y:b.clientY},!1);return{pos:c,bias:(function(a,b,c,d){let e=Od.find(a.docView,b);if(!e)return 1;let f=b-e.posAtStart;if(0==f)return 1;if(f==e.length)return -1;let g=e.coordsAt(f,-1);if(g&&xl(c,d,g))return -1;let h=e.coordsAt(f,1);return h&&xl(c,d,h)?1:g&&wl(d,g)?-1:1})(a,c,b.clientX,b.clientY)}}const zl=ib.ie&&ib.ie_version<=11;let Al=null,Bl=0,Cl=0;function Dl(a){if(!zl)return a.detail;let b=Al,c=Cl;return Al=a,Cl=Date.now(),Bl=!b||c>Date.now()-400&&2>Math.abs(b.clientX-a.clientX)&&2>Math.abs(b.clientY-a.clientY)?(Bl+1)%3:1}function El(a,b){let c=yl(a,b),e=Dl(b),f=a.state.selection,g=c,h=b;return{update(a){a.docChanged&&(c&&(c.pos=a.changes.mapPos(c.pos)),f=f.map(a.changes),h=null)},get(b,i,j){let k;if(h&&b.clientX==h.clientX&&b.clientY==h.clientY?k=g:(k=g=yl(a,b),h=b),!k||!c)return f;let l=vl(a,k.pos,k.bias,e);if(c.pos!=k.pos&&!i){let m=vl(a,c.pos,c.bias,e),n=Math.min(m.from,l.from),o=Math.max(m.to,l.to);l=n<l.from?d.jT.range(n,o):d.jT.range(o,n)}return i?f.replaceRange(f.main.extend(l.from,l.to)):j?f.addRange(l):d.jT.create([l])}}}function Fl(a,b,c,d){if(!c)return;let e=a.posAtCoords({x:b.clientX,y:b.clientY},!1);b.preventDefault();let{mouseSelection:f}=a.inputState,g=d&&f&&f.dragging&&f.dragMove?{from:f.dragging.from,to:f.dragging.to}:null,h={from:e,insert:c},i=a.state.changes(g?[g,h]:h);a.focus(),a.dispatch({changes:i,selection:{anchor:i.mapPos(e,-1),head:i.mapPos(e,1)},userEvent:g?"move.drop":"input.drop"})}rl.dragstart=(a,b)=>{let{selection:{main:c}}=a.state,{mouseSelection:d}=a.inputState;d&&(d.dragging=c),b.dataTransfer&&(b.dataTransfer.setData("Text",a.state.sliceDoc(c.from,c.to)),b.dataTransfer.effectAllowed="copyMove")},rl.drop=(a,b)=>{if(!b.dataTransfer)return;if(a.state.readOnly)return b.preventDefault();let c=b.dataTransfer.files;if(c&&c.length){b.preventDefault();let d=Array(c.length),e=0,f=()=>{++e==c.length&&Fl(a,b,d.filter(a=>null!=a).join(a.state.lineBreak),!1)};for(let g=0;g<c.length;g++){let h=new FileReader;h.onerror=f,h.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(h.result)||(d[g]=h.result),f()},h.readAsText(c[g])}}else Fl(a,b,b.dataTransfer.getData("Text"),!0)},rl.paste=(a,b)=>{if(a.state.readOnly)return b.preventDefault();a.observer.flush();let c=sl?null:b.clipboardData;c?(tl(a,c.getData("text/plain")),b.preventDefault()):(function(a){let b=a.dom.parentNode;if(!b)return;let c=b.appendChild(document.createElement("textarea"));c.style.cssText="position: fixed; left: -10000px; top: 10px",c.focus(),setTimeout(()=>{a.focus(),c.remove(),tl(a,c.value)},50)})(a)};let Gl=null;function Hl(a,b){if(a.docView.compositionDeco.size){a.inputState.rapidCompositionStart=b;try{a.update([])}finally{a.inputState.rapidCompositionStart=!1}}}rl.copy=rl.cut=(a,b)=>{let{text:c,ranges:d,linewise:e}=function(a){let b=[],c=[],d=!1;for(let e of a.selection.ranges)e.empty||(b.push(a.sliceDoc(e.from,e.to)),c.push(e));if(!b.length){let f=-1;for(let{from:g}of a.selection.ranges){let h=a.doc.lineAt(g);h.number>f&&(b.push(h.text),c.push({from:h.from,to:Math.min(a.doc.length,h.to+1)})),f=h.number}d=!0}return{text:b.join(a.lineBreak),ranges:c,linewise:d}}(a.state);if(!c&&!e)return;Gl=e?c:null;let f=sl?null:b.clipboardData;f?(b.preventDefault(),f.clearData(),f.setData("text/plain",c)):(function(a,b){let c=a.dom.parentNode;if(!c)return;let d=c.appendChild(document.createElement("textarea"));d.style.cssText="position: fixed; left: -10000px; top: 10px",d.value=b,d.focus(),d.selectionEnd=b.length,d.selectionStart=0,setTimeout(()=>{d.remove(),a.focus()},50)})(a,c),"cut"!=b.type||a.state.readOnly||a.dispatch({changes:d,scrollIntoView:!0,userEvent:"delete.cut"})},rl.focus=rl.blur=a=>{setTimeout(()=>{a.hasFocus!=a.inputState.notifiedFocused&&a.update([])},10)},rl.beforeprint=a=>{a.viewState.printing=!0,a.requestMeasure(),setTimeout(()=>{a.viewState.printing=!1,a.requestMeasure()},2000)},rl.compositionstart=rl.compositionupdate=a=>{null==a.inputState.compositionFirstChange&&(a.inputState.compositionFirstChange=!0),a.inputState.composing<0&&(a.inputState.composing=0,a.docView.compositionDeco.size&&(a.observer.flush(),Hl(a,!0)))},rl.compositionend=a=>{a.inputState.composing=-1,a.inputState.compositionEndedAt=Date.now(),a.inputState.compositionFirstChange=null,setTimeout(()=>{a.inputState.composing<0&&Hl(a,!1)},50)},rl.contextmenu=a=>{a.inputState.lastContextMenu=Date.now()},rl.beforeinput=(a,b)=>{var c;let d;if(ib.chrome&&ib.android&&(d=Yk.find(a=>a.inputType==b.inputType))&&(a.observer.delayAndroidKey(d.key,d.keyCode),"Backspace"==d.key||"Delete"==d.key)){let e=(null===(c=window.visualViewport)|| void 0===c?void 0:c.height)||0;setTimeout(()=>{var b;((null===(b=window.visualViewport)|| void 0===b?void 0:b.height)||0)>e+10&&a.hasFocus&&(a.contentDOM.blur(),a.focus())},100)}};const Il=["pre-wrap","normal","pre-line","break-spaces"];class Jl{constructor(Kl,Ll){this.from=Kl,this.heights=Ll,this.index=0}get more(){return this.index<this.heights.length}}class Ml{constructor(Nl,Ol,Pl,Ql,Rl){this.from=Nl,this.length=Ol,this.top=Pl,this.height=Ql,this.type=Rl}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(Sl){let Tl=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(Sl.type)?Sl.type:[Sl]);return new Ml(this.from,this.length+Sl.length,this.top,this.height+Sl.height,Tl)}moveY(Ul){return Ul?new Ml(this.from,this.length,this.top+Ul,this.height,Array.isArray(this.type)?this.type.map(a=>a.moveY(Ul)):this.type):this}}var Vl,Wl=((Vl=Wl||(Wl={}))[Vl.ByPos=0]="ByPos",Vl[Vl.ByHeight=1]="ByHeight",Vl[Vl.ByPosNoHeight=2]="ByPosNoHeight",Vl);class Xl{constructor(Yl,Zl,$l=2){this.length=Yl,this.height=Zl,this.flags=$l}get outdated(){return(2&this.flags)>0}set outdated(_l){this.flags=(_l?2:0)| -3&this.flags}setHeight(am,bm){this.height!=bm&&(Math.abs(this.height-bm)>0.001&&(am.heightChanged=!0),this.height=bm)}replace(cm,dm,em){return Xl.of(em)}decomposeLeft(fm,gm){gm.push(this)}decomposeRight(hm,im){im.push(this)}applyChanges(jm,km,lm,mm){let nm=this;for(let om=mm.length-1;om>=0;om--){let{fromA:pm,toA:qm,fromB:rm,toB:sm}=mm[om],tm=nm.lineAt(pm,Wl.ByPosNoHeight,km,0,0),um=tm.to>=qm?tm:nm.lineAt(qm,Wl.ByPosNoHeight,km,0,0);for(sm+=um.to-qm,qm=um.to;om>0&&tm.from<=mm[om-1].toA;)pm=mm[om-1].fromA,rm=mm[om-1].fromB,om--,pm<tm.from&&(tm=nm.lineAt(pm,Wl.ByPosNoHeight,km,0,0));rm+=tm.from-pm,pm=tm.from;let vm=wp.build(lm,jm,rm,sm);nm=nm.replace(pm,qm,vm)}return nm.updateHeight(lm,0)}static empty(){return new bn(0,0)}static of(wm){if(1==wm.length)return wm[0];let xm=0,ym=wm.length,zm=0,Am=0;for(;;)if(xm==ym)if(zm>2*Am){let Bm=wm[xm-1];Bm.break?wm.splice(--xm,1,Bm.left,null,Bm.right):wm.splice(--xm,1,Bm.left,Bm.right),ym+=1+Bm.break,zm-=Bm.size}else if(Am>2*zm){let Cm=wm[ym];Cm.break?wm.splice(ym,1,Cm.left,null,Cm.right):wm.splice(ym,1,Cm.left,Cm.right),ym+=2+Cm.break,Am-=Cm.size}else break;else if(zm<Am){let Dm=wm[xm++];Dm&&(zm+=Dm.size)}else{let Em=wm[--ym];Em&&(Am+=Em.size)}let Fm=0;return null==wm[xm-1]?(Fm=1,xm--):null==wm[xm]&&(Fm=1,ym++),new wo(Xl.of(wm.slice(0,xm)),Fm,Xl.of(wm.slice(ym)))}}Xl.prototype.size=1;class Gm extends Xl{constructor(Hm,Im,Jm){super(Hm,Im),this.type=Jm}blockAt(Km,Lm,Mm,Nm){return new Ml(Nm,this.length,Mm,this.height,this.type)}lineAt(Om,Pm,Qm,Rm,Sm){return this.blockAt(0,Qm,Rm,Sm)}forEachLine(Tm,Um,Vm,Wm,Xm,Ym){Ym(this.blockAt(0,Vm,Wm,Xm))}updateHeight(Zm,$m=0,_m=!1,an){return an&&an.from<=$m&&an.more&&this.setHeight(Zm,an.heights[an.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class bn extends Gm{constructor(cn,dn){super(cn,dn,$c.Text),this.collapsed=0,this.widgetHeight=0}replace(en,fn,gn){let hn=gn[0];return 1==gn.length&&(hn instanceof bn||hn instanceof nn&&4&hn.flags)&&10>Math.abs(this.length-hn.length)?(hn instanceof nn?hn=new bn(hn.length,this.height):hn.height=this.height,this.outdated||(hn.outdated=!1),hn):Xl.of(gn)}updateHeight(jn,kn=0,ln=!1,mn){return mn&&mn.from<=kn&&mn.more?this.setHeight(jn,mn.heights[mn.index++]):(ln||this.outdated)&&this.setHeight(jn,Math.max(this.widgetHeight,jn.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class nn extends Xl{constructor(on){super(on,0)}lines(pn,qn){let rn=pn.lineAt(qn).number,sn=pn.lineAt(qn+this.length).number;return{firstLine:rn,lastLine:sn,lineHeight:this.height/(sn-rn+1)}}blockAt(tn,un,vn,wn){let{firstLine:xn,lastLine:yn,lineHeight:zn}=this.lines(un,wn),An=Math.max(0,Math.min(yn-xn,Math.floor((tn-vn)/zn))),{from:Bn,length:Cn}=un.line(xn+An);return new Ml(Bn,Cn,vn+zn*An,zn,$c.Text)}lineAt(Dn,En,Fn,Gn,Hn){if(En==Wl.ByHeight)return this.blockAt(Dn,Fn,Gn,Hn);if(En==Wl.ByPosNoHeight){let{from:In,to:Jn}=Fn.lineAt(Dn);return new Ml(In,Jn-In,0,0,$c.Text)}let{firstLine:Kn,lineHeight:Ln}=this.lines(Fn,Hn),{from:Mn,length:Nn,number:On}=Fn.lineAt(Dn);return new Ml(Mn,Nn,Gn+Ln*(On-Kn),Ln,$c.Text)}forEachLine(Pn,Qn,Rn,Sn,Tn,Un){let{firstLine:Vn,lineHeight:Wn}=this.lines(Rn,Tn);for(let Xn=Math.max(Pn,Tn),Yn=Math.min(Tn+this.length,Qn);Xn<=Yn;){let Zn=Rn.lineAt(Xn);Xn==Pn&&(Sn+=Wn*(Zn.number-Vn)),Un(new Ml(Zn.from,Zn.length,Sn,Wn,$c.Text)),Sn+=Wn,Xn=Zn.to+1}}replace($n,_n,ao){let bo=this.length-_n;if(bo>0){let co=ao[ao.length-1];co instanceof nn?ao[ao.length-1]=new nn(co.length+bo):ao.push(null,new nn(bo-1))}if($n>0){let eo=ao[0];eo instanceof nn?ao[0]=new nn($n+eo.length):ao.unshift(new nn($n-1),null)}return Xl.of(ao)}decomposeLeft(fo,go){go.push(new nn(fo-1),null)}decomposeRight(ho,io){io.push(null,new nn(this.length-ho-1))}updateHeight(jo,ko=0,lo=!1,mo){let no=ko+this.length;if(mo&&mo.from<=ko+this.length&&mo.more){let oo=[],po=Math.max(ko,mo.from),qo=-1,ro=jo.heightChanged;for(mo.from>ko&&oo.push(new nn(mo.from-ko-1).updateHeight(jo,ko));po<=no&&mo.more;){let so=jo.doc.lineAt(po).length;oo.length&&oo.push(null);let to=mo.heights[mo.index++];-1==qo?qo=to:Math.abs(to-qo)>=0.001&&(qo=-2);let uo=new bn(so,to);uo.outdated=!1,oo.push(uo),po+=so+1}po<=no&&oo.push(null,new nn(no-po).updateHeight(jo,po));let vo=Xl.of(oo);return jo.heightChanged=ro||qo<0||Math.abs(vo.height-this.height)>=0.001||Math.abs(qo-this.lines(jo.doc,ko).lineHeight)>=0.001,vo}return(lo||this.outdated)&&(this.setHeight(jo,jo.heightForGap(ko,ko+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class wo extends Xl{constructor(xo,yo,zo){super(xo.length+yo+zo.length,xo.height+zo.height,yo|(xo.outdated||zo.outdated?2:0)),this.left=xo,this.right=zo,this.size=xo.size+zo.size}get break(){return 1&this.flags}blockAt(Ao,Bo,Co,Do){let Eo=Co+this.left.height;return Ao<Eo?this.left.blockAt(Ao,Bo,Co,Do):this.right.blockAt(Ao,Bo,Eo,Do+this.left.length+this.break)}lineAt(Fo,Go,Ho,Io,Jo){let Ko=Io+this.left.height,Lo=Jo+this.left.length+this.break,Mo=Go==Wl.ByHeight?Fo<Ko:Fo<Lo,No=Mo?this.left.lineAt(Fo,Go,Ho,Io,Jo):this.right.lineAt(Fo,Go,Ho,Ko,Lo);if(this.break||(Mo?No.to<Lo:No.from>Lo))return No;let Oo=Go==Wl.ByPosNoHeight?Wl.ByPosNoHeight:Wl.ByPos;return Mo?No.join(this.right.lineAt(Lo,Oo,Ho,Ko,Lo)):this.left.lineAt(Lo,Oo,Ho,Io,Jo).join(No)}forEachLine(Po,Qo,Ro,So,To,Uo){let Vo=So+this.left.height,Wo=To+this.left.length+this.break;if(this.break)Po<Wo&&this.left.forEachLine(Po,Qo,Ro,So,To,Uo),Qo>=Wo&&this.right.forEachLine(Po,Qo,Ro,Vo,Wo,Uo);else{let Xo=this.lineAt(Wo,Wl.ByPos,Ro,So,To);Po<Xo.from&&this.left.forEachLine(Po,Xo.from-1,Ro,So,To,Uo),Xo.to>=Po&&Xo.from<=Qo&&Uo(Xo),Qo>Xo.to&&this.right.forEachLine(Xo.to+1,Qo,Ro,Vo,Wo,Uo)}}replace(Yo,Zo,$o){let _o=this.left.length+this.break;if(Zo<_o)return this.balanced(this.left.replace(Yo,Zo,$o),this.right);if(Yo>this.left.length)return this.balanced(this.left,this.right.replace(Yo-_o,Zo-_o,$o));let ap=[];Yo>0&&this.decomposeLeft(Yo,ap);let bp=ap.length;for(let cp of $o)ap.push(cp);if(Yo>0&&vp(ap,bp-1),Zo<this.length){let dp=ap.length;this.decomposeRight(Zo,ap),vp(ap,dp)}return Xl.of(ap)}decomposeLeft(ep,fp){let gp=this.left.length;if(ep<=gp)return this.left.decomposeLeft(ep,fp);fp.push(this.left),this.break&&(gp++,ep>=gp&&fp.push(null)),ep>gp&&this.right.decomposeLeft(ep-gp,fp)}decomposeRight(hp,ip){let jp=this.left.length,kp=jp+this.break;if(hp>=kp)return this.right.decomposeRight(hp-kp,ip);hp<jp&&this.left.decomposeRight(hp,ip),this.break&&hp<kp&&ip.push(null),ip.push(this.right)}balanced(lp,mp){return lp.size>2*mp.size||mp.size>2*lp.size?Xl.of(this.break?[lp,null,mp]:[lp,mp]):(this.left=lp,this.right=mp,this.height=lp.height+mp.height,this.outdated=lp.outdated||mp.outdated,this.size=lp.size+mp.size,this.length=lp.length+this.break+mp.length,this)}updateHeight(np,op=0,pp=!1,qp){let{left:rp,right:sp}=this,tp=op+rp.length+this.break,up=null;return(qp&&qp.from<=op+rp.length&&qp.more?up=rp=rp.updateHeight(np,op,pp,qp):rp.updateHeight(np,op,pp),qp&&qp.from<=tp+sp.length&&qp.more?up=sp=sp.updateHeight(np,tp,pp,qp):sp.updateHeight(np,tp,pp),up)?this.balanced(rp,sp):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function vp(a,b){let c,d;null==a[b]&&(c=a[b-1])instanceof nn&&(d=a[b+1])instanceof nn&&a.splice(b-1,3,new nn(c.length+1+d.length))}class wp{constructor(xp,yp){this.pos=xp,this.oracle=yp,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=xp}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(zp,Ap){if(this.lineStart> -1){let Bp=Math.min(Ap,this.lineEnd),Cp=this.nodes[this.nodes.length-1];Cp instanceof bn?Cp.length+=Bp-this.pos:(Bp>this.pos||!this.isCovered)&&this.nodes.push(new bn(Bp-this.pos,-1)),this.writtenTo=Bp,Ap>Bp&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=Ap}point(Dp,Ep,Fp){if(Dp<Ep||Fp.heightRelevant){let Gp=Fp.widget?Fp.widget.estimatedHeight:0;Gp<0&&(Gp=this.oracle.lineHeight);let Hp=Ep-Dp;Fp.block?this.addBlock(new Gm(Hp,Gp,Fp.type)):(Hp||Gp>=5)&&this.addLineDeco(Gp,Hp)}else Ep>Dp&&this.span(Dp,Ep);this.lineEnd> -1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart> -1)return;let{from:Ip,to:Jp}=this.oracle.doc.lineAt(this.pos);this.lineStart=Ip,this.lineEnd=Jp,this.writtenTo<Ip&&((this.writtenTo<Ip-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,Ip-1)),this.nodes.push(null)),this.pos>Ip&&this.nodes.push(new bn(this.pos-Ip,-1)),this.writtenTo=this.pos}blankContent(Kp,Lp){let Mp=new nn(Lp-Kp);return this.oracle.doc.lineAt(Kp).to==Lp&&(Mp.flags|=4),Mp}ensureLine(){this.enterLine();let Np=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(Np instanceof bn)return Np;let Op=new bn(0,-1);return this.nodes.push(Op),Op}addBlock(Pp){this.enterLine(),Pp.type!=$c.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(Pp),this.writtenTo=this.pos=this.pos+Pp.length,Pp.type!=$c.WidgetBefore&&(this.covering=Pp)}addLineDeco(Qp,Rp){let Sp=this.ensureLine();Sp.length+=Rp,Sp.collapsed+=Rp,Sp.widgetHeight=Math.max(Sp.widgetHeight,Qp),this.writtenTo=this.pos=this.pos+Rp}finish(Tp){let Up=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart> -1)||Up instanceof bn||this.isCovered?(this.writtenTo<this.pos||null==Up)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new bn(0,-1));let Vp=Tp;for(let Wp of this.nodes)Wp instanceof bn&&Wp.updateHeight(this.oracle,Vp),Vp+=Wp?Wp.length:1;return this.nodes}static build(Xp,Yp,Zp,$p){let _p=new wp(Zp,Xp);return g.Xs.spans(Yp,Zp,$p,_p,0),_p.finish(Zp)}}class aq{constructor(){this.changes=[]}compareRange(){}comparePoint(bq,cq,dq,eq){(bq<cq||dq&&dq.heightRelevant||eq&&eq.heightRelevant)&&Nd(bq,cq,this.changes,5)}}class fq{constructor(gq,hq,iq){this.from=gq,this.to=hq,this.size=iq}static same(jq,kq){if(jq.length!=kq.length)return!1;for(let lq=0;lq<jq.length;lq++){let mq=jq[lq],nq=kq[lq];if(mq.from!=nq.from||mq.to!=nq.to||mq.size!=nq.size)return!1}return!0}draw(oq){return _c.replace({widget:new pq(this.size,oq)}).range(this.from,this.to)}}class pq extends Tc{constructor(qq,rq){super(),this.size=qq,this.vertical=rq}eq(sq){return sq.size==this.size&&sq.vertical==this.vertical}toDOM(){let tq=document.createElement("div");return this.vertical?tq.style.height=this.size+"px":(tq.style.width=this.size+"px",tq.style.height="2px",tq.style.display="inline-block"),tq}get estimatedHeight(){return this.vertical?this.size:-1}}class uq{constructor(vq){this.state=vq,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new class{constructor(){this.doc=e.xv.empty,this.lineWrapping=!1,this.direction=nh.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(wq,xq){let yq=this.doc.lineAt(xq).number-this.doc.lineAt(wq).number+1;return this.lineWrapping&&(yq+=Math.ceil((xq-wq-yq*this.lineLength*0.5)/this.lineLength)),this.lineHeight*yq}heightForLine(zq){return this.lineWrapping?(1+Math.max(0,Math.ceil((zq-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(Aq){return this.doc=Aq,this}mustRefreshForStyle(Bq,Cq){return Il.indexOf(Bq)> -1!=this.lineWrapping||this.direction!=Cq}mustRefreshForHeights(Dq){let Eq=!1;for(let Fq=0;Fq<Dq.length;Fq++){let Gq=Dq[Fq];Gq<0?Fq++:this.heightSamples[Math.floor(10*Gq)]||(Eq=!0,this.heightSamples[Math.floor(10*Gq)]=!0)}return Eq}refresh(Hq,Iq,Jq,Kq,Lq,Mq){let Nq=Il.indexOf(Hq)> -1,Oq=Math.round(Jq)!=Math.round(this.lineHeight)||this.lineWrapping!=Nq||this.direction!=Iq;if(this.lineWrapping=Nq,this.direction=Iq,this.lineHeight=Jq,this.charWidth=Kq,this.lineLength=Lq,Oq){this.heightSamples={};for(let Pq=0;Pq<Mq.length;Pq++){let Qq=Mq[Pq];Qq<0?Pq++:this.heightSamples[Math.floor(10*Qq)]=!0}}return Oq}},this.scaler=Js,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Xl.empty().applyChanges(vq.facet(Hg),e.xv.empty,this.heightOracle.setDoc(vq.doc),[new Jg(0,0,0,vq.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=_c.set(this.lineGaps.map(a=>a.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let Rq=[this.viewport],{main:Sq}=this.state.selection;for(let Tq=0;Tq<=1;Tq++){let Uq=Tq?Sq.head:Sq.anchor;if(!Rq.some(({from:a,to:b})=>Uq>=a&&Uq<=b)){let{from:Vq,to:Wq}=this.lineBlockAt(Uq);Rq.push(new Bs(Vq,Wq))}}this.viewports=Rq.sort((a,b)=>a.from-b.from),this.scaler=this.heightMap.height<=70e5?Js:new Ks(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,a=>{this.viewportLines.push(1==this.scaler.scale?a:at(a,this.scaler))})}update(Xq,Yq=null){var Zq,$q,_q;let ar=this.state;this.state=Xq.state;let br=this.state.facet(Hg),cr=Xq.changedRanges,dr,er=Jg.extendWithRanges(cr,(Zq=Xq.startState.facet(Hg),$q=br,_q=Xq?Xq.changes:d.as.empty(this.state.doc.length),dr=new aq,g.Xs.compare(Zq,$q,_q,dr,0),dr.changes)),fr=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(br,ar.doc,this.heightOracle.setDoc(this.state.doc),er),this.heightMap.height!=fr&&(Xq.flags|=2);let gr=er.length?this.mapViewport(this.viewport,Xq.changes):this.viewport;(Yq&&(Yq.range.head<gr.from||Yq.range.head>gr.to)||!this.viewportIsAppropriate(gr))&&(gr=this.getViewport(0,Yq));let hr=!Xq.changes.empty||2&Xq.flags||gr.from!=this.viewport.from||gr.to!=this.viewport.to;this.viewport=gr,this.updateForViewport(),hr&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4000)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,Xq.changes))),Xq.flags|=this.computeVisibleRanges(),Yq&&(this.scrollTarget=Yq),!this.mustEnforceCursorAssoc&&Xq.selectionSet&&Xq.view.lineWrapping&&Xq.state.selection.main.empty&&Xq.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(ir){let jr=ir.contentDOM,kr=window.getComputedStyle(jr),lr=this.heightOracle,mr=kr.whiteSpace,nr="rtl"==kr.direction?nh.RTL:nh.LTR,or=this.heightOracle.mustRefreshForStyle(mr,nr),pr=or||this.mustMeasureContent||this.contentDOMHeight!=jr.clientHeight,qr=0,rr=0;if(this.editorWidth!=ir.scrollDOM.clientWidth&&(lr.lineWrapping&&(pr=!0),this.editorWidth=ir.scrollDOM.clientWidth,qr|=8),pr){this.mustMeasureContent=!1,this.contentDOMHeight=jr.clientHeight;let sr=parseInt(kr.paddingTop)||0,tr=parseInt(kr.paddingBottom)||0;(this.paddingTop!=sr||this.paddingBottom!=tr)&&(qr|=8,this.paddingTop=sr,this.paddingBottom=tr)}let ur=this.printing?{top:-10e7,bottom:10e7,left:-10e7,right:10e7}:function(a,b){let c=a.getBoundingClientRect(),d=Math.max(0,c.left),e=Math.min(innerWidth,c.right),f=Math.max(0,c.top),g=Math.min(innerHeight,c.bottom),h=a.ownerDocument.body;for(let i=a.parentNode;i&&i!=h;)if(1==i.nodeType){let j=i,k=window.getComputedStyle(j);if((j.scrollHeight>j.clientHeight||j.scrollWidth>j.clientWidth)&&"visible"!=k.overflow){let l=j.getBoundingClientRect();d=Math.max(d,l.left),e=Math.min(e,l.right),f=Math.max(f,l.top),g=Math.min(g,l.bottom)}i="absolute"==k.position||"fixed"==k.position?j.offsetParent:j.parentNode}else if(11==i.nodeType)i=i.host;else break;return{left:d-c.left,right:Math.max(d,e)-c.left,top:f-(c.top+b),bottom:Math.max(f,g)-(c.top+b)}}(jr,this.paddingTop),vr=ur.top-this.pixelViewport.top,wr=ur.bottom-this.pixelViewport.bottom;this.pixelViewport=ur;let xr=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(xr!=this.inView&&(this.inView=xr,xr&&(pr=!0)),!this.inView)return 0;let yr=jr.clientWidth;if((this.contentDOMWidth!=yr||this.editorHeight!=ir.scrollDOM.clientHeight)&&(this.contentDOMWidth=yr,this.editorHeight=ir.scrollDOM.clientHeight,qr|=8),pr){let zr=ir.docView.measureVisibleLineHeights();if(lr.mustRefreshForHeights(zr)&&(or=!0),or||lr.lineWrapping&&Math.abs(yr-this.contentDOMWidth)>lr.charWidth){let{lineHeight:Ar,charWidth:Br}=ir.docView.measureTextSize();(or=lr.refresh(mr,nr,Ar,Br,yr/Br,zr))&&(ir.docView.minWidth=0,qr|=8)}vr>0&&wr>0?rr=Math.max(vr,wr):vr<0&&wr<0&&(rr=Math.min(vr,wr)),lr.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(lr,0,or,new Jl(this.viewport.from,zr)),lr.heightChanged&&(qr|=2)}let Cr=!this.viewportIsAppropriate(this.viewport,rr)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return Cr&&(this.viewport=this.getViewport(rr,this.scrollTarget)),this.updateForViewport(),(2&qr||Cr)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4000)&&this.updateLineGaps(this.ensureLineGaps(or?[]:this.lineGaps)),qr|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,ir.docView.enforceCursorAssoc()),qr}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(Dr,Er){let Fr=0.5-Math.max(-0.5,Math.min(0.5,Dr/1000/2)),Gr=this.heightMap,Hr=this.state.doc,{visibleTop:Ir,visibleBottom:Jr}=this,Kr=new Bs(Gr.lineAt(Ir-1000*Fr,Wl.ByHeight,Hr,0,0).from,Gr.lineAt(Jr+(1-Fr)*1000,Wl.ByHeight,Hr,0,0).to);if(Er){let{head:Lr}=Er.range;if(Lr<Kr.from||Lr>Kr.to){let Mr=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),Nr=Gr.lineAt(Lr,Wl.ByPos,Hr,0,0),Or;Or="center"==Er.y?(Nr.top+Nr.bottom)/2-Mr/2:"start"==Er.y||"nearest"==Er.y&&Lr<Kr.from?Nr.top:Nr.bottom-Mr,Kr=new Bs(Gr.lineAt(Or-500,Wl.ByHeight,Hr,0,0).from,Gr.lineAt(Or+Mr+500,Wl.ByHeight,Hr,0,0).to)}}return Kr}mapViewport(Pr,Qr){let Rr=Qr.mapPos(Pr.from,-1),Sr=Qr.mapPos(Pr.to,1);return new Bs(this.heightMap.lineAt(Rr,Wl.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(Sr,Wl.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:Tr,to:Ur},Vr=0){if(!this.inView)return!0;let{top:Wr}=this.heightMap.lineAt(Tr,Wl.ByPos,this.state.doc,0,0),{bottom:Xr}=this.heightMap.lineAt(Ur,Wl.ByPos,this.state.doc,0,0),{visibleTop:Yr,visibleBottom:Zr}=this;return(0==Tr||Wr<=Yr-Math.max(10,Math.min(-Vr,250)))&&(Ur==this.state.doc.length||Xr>=Zr+Math.max(10,Math.min(Vr,250)))&&Wr>Yr-2000&&Xr<Zr+2000}mapLineGaps($r,_r){if(!$r.length||_r.empty)return $r;let as=[];for(let bs of $r)_r.touchesRange(bs.from,bs.to)||as.push(new fq(_r.mapPos(bs.from),_r.mapPos(bs.to),bs.size));return as}ensureLineGaps(cs){let ds=[];if(this.heightOracle.direction!=nh.LTR)return ds;for(let es of this.viewportLines){if(es.length<4000)continue;let fs=Es(es.from,es.to,this.state);if(fs.total<4000)continue;let gs,hs;if(this.heightOracle.lineWrapping){let is=2000/this.heightOracle.lineLength*this.heightOracle.lineHeight;gs=Fs(fs,(this.visibleTop-es.top-is)/es.height),hs=Fs(fs,(this.visibleBottom-es.top+is)/es.height)}else{let js=fs.total*this.heightOracle.charWidth,ks=2000*this.heightOracle.charWidth;gs=Fs(fs,(this.pixelViewport.left-ks)/js),hs=Fs(fs,(this.pixelViewport.right+ks)/js)}let ls=[];gs>es.from&&ls.push({from:es.from,to:gs}),hs<es.to&&ls.push({from:hs,to:es.to});let ms=this.state.selection.main;for(let{from:ns,to:os}of(ms.from>=es.from&&ms.from<=es.to&&Hs(ls,ms.from-10,ms.from+10),!ms.empty&&ms.to>=es.from&&ms.to<=es.to&&Hs(ls,ms.to-10,ms.to+10),ls))os-ns>1000&&ds.push(Is(cs,a=>a.from>=es.from&&a.to<=es.to&&1000>Math.abs(a.from-ns)&&1000>Math.abs(a.to-os))||new fq(ns,os,this.gapSize(es,ns,os,fs)))}return ds}gapSize(ps,qs,rs,ss){let ts=Gs(ss,rs)-Gs(ss,qs);return this.heightOracle.lineWrapping?ps.height*ts:ss.total*this.heightOracle.charWidth*ts}updateLineGaps(us){fq.same(us,this.lineGaps)||(this.lineGaps=us,this.lineGapDeco=_c.set(us.map(a=>a.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let vs=this.state.facet(Hg);this.lineGaps.length&&(vs=vs.concat(this.lineGapDeco));let ws=[];g.Xs.spans(vs,this.viewport.from,this.viewport.to,{span(a,b){ws.push({from:a,to:b})},point(){}},20);let xs=ws.length!=this.visibleRanges.length||this.visibleRanges.some((a,b)=>a.from!=ws[b].from||a.to!=ws[b].to);return this.visibleRanges=ws,xs?4:0}lineBlockAt(ys){return ys>=this.viewport.from&&ys<=this.viewport.to&&this.viewportLines.find(a=>a.from<=ys&&a.to>=ys)||at(this.heightMap.lineAt(ys,Wl.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(zs){return at(this.heightMap.lineAt(this.scaler.fromDOM(zs),Wl.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(As){return at(this.heightMap.blockAt(this.scaler.fromDOM(As),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Bs{constructor(Cs,Ds){this.from=Cs,this.to=Ds}}function Es(a,b,c){let d=[],e=a,f=0;return g.Xs.spans(c.facet(Hg),a,b,{span(){},point(a,b){a>e&&(d.push({from:e,to:a}),f+=a-e),e=b}},20),e<b&&(d.push({from:e,to:b}),f+=b-e),{total:f,ranges:d}}function Fs({total:a,ranges:b},c){if(c<=0)return b[0].from;if(c>=1)return b[b.length-1].to;let d=Math.floor(a*c);for(let e=0;;e++){let{from:f,to:g}=b[e],h=g-f;if(d<=h)return f+d;d-=h}}function Gs(a,b){let c=0;for(let{from:d,to:e}of a.ranges){if(b<=e){c+=b-d;break}c+=e-d}return c/a.total}function Hs(a,b,c){for(let d=0;d<a.length;d++){let e=a[d];if(e.from<c&&e.to>b){let f=[];e.from<b&&f.push({from:e.from,to:b}),e.to>c&&f.push({from:c,to:e.to}),a.splice(d,1,...f),d+=f.length-1}}}function Is(a,b){for(let c of a)if(b(c))return c}const Js={toDOM(a){return a},fromDOM(a){return a},scale:1};class Ks{constructor(Ls,Ms,Ns){let Os=0,Ps=0,Qs=0;for(let Rs of(this.viewports=Ns.map(({from:a,to:b})=>{let c=Ms.lineAt(a,Wl.ByPos,Ls,0,0).top,d=Ms.lineAt(b,Wl.ByPos,Ls,0,0).bottom;return Os+=d-c,{from:a,to:b,top:c,bottom:d,domTop:0,domBottom:0}}),this.scale=(70e5-Os)/(Ms.height-Os),this.viewports))Rs.domTop=Qs+(Rs.top-Ps)*this.scale,Qs=Rs.domBottom=Rs.domTop+(Rs.bottom-Rs.top),Ps=Rs.bottom}toDOM(Ss){for(let Ts=0,Us=0,Vs=0;;Ts++){let Ws=Ts<this.viewports.length?this.viewports[Ts]:null;if(!Ws||Ss<Ws.top)return Vs+(Ss-Us)*this.scale;if(Ss<=Ws.bottom)return Ws.domTop+(Ss-Ws.top);Us=Ws.bottom,Vs=Ws.domBottom}}fromDOM(Xs){for(let Ys=0,Zs=0,$s=0;;Ys++){let _s=Ys<this.viewports.length?this.viewports[Ys]:null;if(!_s||Xs<_s.domTop)return Zs+(Xs-$s)/this.scale;if(Xs<=_s.domBottom)return _s.top+(Xs-_s.domTop);Zs=_s.bottom,$s=_s.domBottom}}}function at(a,b){if(1==b.scale)return a;let c=b.toDOM(a.top),d=b.toDOM(a.bottom);return new Ml(a.from,a.length,c,d-c,Array.isArray(a.type)?a.type.map(a=>at(a,b)):a.type)}const bt=d.r$.define({combine:a=>a.join(" ")}),ct=d.r$.define({combine:a=>a.indexOf(!0)> -1}),dt=f.V.newName(),et=f.V.newName(),ft=f.V.newName(),gt={"&light":"."+et,"&dark":"."+ft};function ht(a,b,c){return new f.V(b,{finish(b){return/&/.test(b)?b.replace(/&\w*/,b=>{if("&"==b)return a;if(!c||!c[b])throw new RangeError(`Unsupported selector: ${b}`);return c[b]}):a+" "+b}})}const it=ht("."+dt,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-bottom",height:"1em"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},gt),jt={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},kt=ib.ie&&ib.ie_version<=11;function lt(a,b,c){for(;b;){let d=I.get(b);if(d&&d.parent==a)return d;let e=b.parentNode;b=e!=a.dom?e:c>0?b.nextSibling:b.previousSibling}return null}class mt{constructor(nt={}){for(let ot of(this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=nt.dispatch||(a=>this.update([a])),this.dispatch=this.dispatch.bind(this),this.root=nt.root||(function(a){for(;a;){if(a&&(9==a.nodeType||11==a.nodeType&&a.host))return a;a=a.assignedSlot||a.parentNode}return null})(nt.parent)||document,this.viewState=new uq(nt.state||d.yy.create()),this.plugins=this.state.facet(cg).map(a=>new rg(a)),this.plugins))ot.update(this);this.observer=new class{constructor(pt,qt,rt){this.view=pt,this.onChange=qt,this.onScrollChanged=rt,this.active=!1,this.selectionRange=new class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(st){return this.anchorNode==st.anchorNode&&this.anchorOffset==st.anchorOffset&&this.focusNode==st.focusNode&&this.focusOffset==st.focusOffset}setRange(tt){this.set(tt.anchorNode,tt.anchorOffset,tt.focusNode,tt.focusOffset)}set(ut,vt,wt,xt){this.anchorNode=ut,this.anchorOffset=vt,this.focusNode=wt,this.focusOffset=xt}},this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=pt.contentDOM,this.observer=new MutationObserver(a=>{for(let b of a)this.queue.push(b);(ib.ie&&ib.ie_version<=11||ib.ios&&pt.composing)&&a.some(a=>"childList"==a.type&&a.removedNodes.length||"characterData"==a.type&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),kt&&(this.onCharData=a=>{this.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}),this.resize.observe(pt.scrollDOM)),this.start(),this.onScroll=this.onScroll.bind(this),window.addEventListener("scroll",this.onScroll),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver(a=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1000)),a.length>0&&a[a.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(a=>{a.length>0&&a[a.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(yt){this.intersecting&&this.flush(!1),this.onScrollChanged(yt)}updateGaps(zt){if(this.gapIntersection&&(zt.length!=this.gaps.length||this.gaps.some((a,b)=>a!=zt[b]))){for(let At of(this.gapIntersection.disconnect(),zt))this.gapIntersection.observe(At);this.gaps=zt}}onSelectionChange(Bt){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:Ct}=this,Dt=this.selectionRange;if(Ct.state.facet(Xf)?Ct.root.activeElement!=this.dom:!k(Ct.dom,Dt))return;let Et=Dt.anchorNode&&Ct.docView.nearest(Dt.anchorNode);Et&&Et.ignoreEvent(Bt)||((ib.ie&&ib.ie_version<=11||ib.android&&ib.chrome)&&!Ct.state.selection.main.empty&&Dt.focusNode&&m(Dt.focusNode,Dt.focusOffset,Dt.anchorNode,Dt.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:Ft}=this.view,Gt=i(Ft),Ht=ib.safari&&11==Ft.nodeType&&function(){let a=document.activeElement;for(;a&&a.shadowRoot;)a=a.shadowRoot.activeElement;return a}()==this.view.contentDOM&&function(a){let b=null;function c(a){a.preventDefault(),a.stopImmediatePropagation(),b=a.getTargetRanges()[0]}if(a.contentDOM.addEventListener("beforeinput",c,!0),document.execCommand("indent"),a.contentDOM.removeEventListener("beforeinput",c,!0),!b)return null;let d=b.startContainer,e=b.startOffset,f=b.endContainer,g=b.endOffset,h=a.docView.domAtPos(a.state.selection.main.anchor);return m(h.node,h.offset,f,g)&&([d,e,f,g]=[f,g,d,e]),{anchorNode:d,anchorOffset:e,focusNode:f,focusOffset:g}}(this.view)||Gt;return!this.selectionRange.eq(Ht)&&(this.selectionRange.setRange(Ht),this.selectionChanged=!0)}setSelectionRange(It,Jt){this.selectionRange.set(It.node,It.offset,Jt.node,Jt.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let Kt=0,Lt=null;for(let Mt=this.dom;Mt;)if(1==Mt.nodeType)!Lt&&Kt<this.scrollTargets.length&&this.scrollTargets[Kt]==Mt?Kt++:Lt||(Lt=this.scrollTargets.slice(0,Kt)),Lt&&Lt.push(Mt),Mt=Mt.assignedSlot||Mt.parentNode;else if(11==Mt.nodeType)Mt=Mt.host;else break;if(Kt<this.scrollTargets.length&&!Lt&&(Lt=this.scrollTargets.slice(0,Kt)),Lt){for(let Nt of this.scrollTargets)Nt.removeEventListener("scroll",this.onScroll);for(let Ot of this.scrollTargets=Lt)Ot.addEventListener("scroll",this.onScroll)}}ignore(Pt){if(!this.active)return Pt();try{return this.stop(),Pt()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,jt),kt&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!!this.active&&(this.active=!1,this.observer.disconnect(),kt&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(Qt,Rt){this.delayedAndroidKey||requestAnimationFrame(()=>{let a=this.delayedAndroidKey;this.delayedAndroidKey=null;let b=this.view.state;x(this.view.contentDOM,a.key,a.keyCode)?this.processRecords():this.flush(),this.view.state==b&&this.view.update([])}),this.delayedAndroidKey&&"Enter"!=Qt||(this.delayedAndroidKey={key:Qt,keyCode:Rt})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let St=this.queue;for(let Tt of this.observer.takeRecords())St.push(Tt);St.length&&(this.queue=[]);let Ut=-1,Vt=-1,Wt=!1;for(let Xt of St){let Yt=this.readMutation(Xt);Yt&&(Yt.typeOver&&(Wt=!0),-1==Ut?{from:Ut,to:Vt}=Yt:(Ut=Math.min(Yt.from,Ut),Vt=Math.max(Yt.to,Vt)))}return{from:Ut,to:Vt,typeOver:Wt}}flush(Zt=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;Zt&&this.readSelectionRange();let{from:$t,to:_t,typeOver:au}=this.processRecords(),bu=this.selectionChanged&&k(this.dom,this.selectionRange);if($t<0&&!bu)return;this.selectionChanged=!1;let cu=this.view.state;this.onChange($t,_t,au),this.view.state==cu&&this.view.update([])}readMutation(du){let eu=this.view.docView.nearest(du.target);if(!eu||eu.ignoreMutation(du))return null;if(eu.markDirty("attributes"==du.type),"attributes"==du.type&&(eu.dirty|=4),"childList"==du.type){let fu=lt(eu,du.previousSibling||du.target.previousSibling,-1),gu=lt(eu,du.nextSibling||du.target.nextSibling,1);return{from:fu?eu.posAfter(fu):eu.posAtStart,to:gu?eu.posBefore(gu):eu.posAtEnd,typeOver:!1}}return"characterData"==du.type?{from:eu.posAtStart,to:eu.posAtEnd,typeOver:du.target.nodeValue==du.oldValue}:null}destroy(){var hu,iu,ju;for(let ku of(this.stop(),null===(hu=this.intersection)|| void 0===hu||hu.disconnect(),null===(iu=this.gapIntersection)|| void 0===iu||iu.disconnect(),null===(ju=this.resize)|| void 0===ju||ju.disconnect(),this.scrollTargets))ku.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}(this,(a,b,c)=>{!function(a,b,c,f){let g,h,i=a.state.selection.main;if(b> -1){let k=a.docView.domBoundsAround(b,c,0);if(!k||a.state.readOnly)return;let{from:l,to:m}=k,n=a.docView.impreciseHead||a.docView.impreciseAnchor?[]:function(a){let b=[];if(a.root.activeElement!=a.contentDOM)return b;let{anchorNode:c,anchorOffset:d,focusNode:e,focusOffset:f}=a.observer.selectionRange;return c&&(b.push(new ui(c,d)),(e!=c||f!=d)&&b.push(new ui(e,f))),b}(a),o=new Rh(n,a.state);o.readRange(k.startDOM,k.endDOM);let p=i.from,q=null;(8===a.inputState.lastKeyCode&&a.inputState.lastKeyTime>Date.now()-100||ib.android&&o.text.length<m-l)&&(p=i.to,q="end");let r=function(a,b,c,d){let e=Math.min(a.length,b.length),f=0;for(;f<e&&a.charCodeAt(f)==b.charCodeAt(f);)f++;if(f==e&&a.length==b.length)return null;let g=a.length,h=b.length;for(;g>0&&h>0&&a.charCodeAt(g-1)==b.charCodeAt(h-1);)g--,h--;if("end"==d){let i=Math.max(0,f-Math.min(g,h));c-=g+i-f}return g<f&&a.length<b.length?(h=(f-=c<=f&&c>=g?f-c:0)+(h-g),g=f):h<f&&(g=(f-=c<=f&&c>=h?f-c:0)+(g-h),h=f),{from:f,toA:g,toB:h}}(a.state.doc.sliceString(l,m,"￿"),o.text,p-l,q);r&&(ib.chrome&&13==a.inputState.lastKeyCode&&r.toB==r.from+2&&"￿￿"==o.text.slice(r.from,r.toB)&&r.toB--,g={from:l+r.from,to:l+r.toA,insert:e.xv.of(o.text.slice(r.from,r.toB).split("￿"))}),h=(function(a,b){if(0==a.length)return null;let c=a[0].pos,e=2==a.length?a[1].pos:c;return c> -1&&e> -1?d.jT.single(c+b,e+b):null})(n,l)}else if(a.hasFocus||!a.state.facet(Xf)){let s=a.observer.selectionRange,{impreciseHead:t,impreciseAnchor:u}=a.docView,v=t&&t.node==s.focusNode&&t.offset==s.focusOffset||!j(a.contentDOM,s.focusNode)?a.state.selection.main.head:a.docView.posFromDOM(s.focusNode,s.focusOffset),w=u&&u.node==s.anchorNode&&u.offset==s.anchorOffset||!j(a.contentDOM,s.anchorNode)?a.state.selection.main.anchor:a.docView.posFromDOM(s.anchorNode,s.anchorOffset);(v!=i.head||w!=i.anchor)&&(h=d.jT.single(w,v))}if(g||h){if(!g&&f&&!i.empty&&h&&h.main.empty?g={from:i.from,to:i.to,insert:a.state.doc.slice(i.from,i.to)}:g&&g.from>=i.from&&g.to<=i.to&&(g.from!=i.from||g.to!=i.to)&&i.to-i.from-(g.to-g.from)<=4&&(g={from:i.from,to:i.to,insert:a.state.doc.slice(i.from,g.from).append(g.insert).append(a.state.doc.slice(g.to,i.to))}),g){let y=a.state;if(ib.ios&&a.inputState.flushIOSKey(a))return;if(ib.android&&(g.from==i.from&&g.to==i.to&&1==g.insert.length&&2==g.insert.lines&&x(a.contentDOM,"Enter",13)||g.from==i.from-1&&g.to==i.to&&0==g.insert.length&&x(a.contentDOM,"Backspace",8)||g.from==i.from&&g.to==i.to+1&&0==g.insert.length&&x(a.contentDOM,"Delete",46)))return;let z=g.insert.toString();if(a.state.facet(Lf).some(b=>b(a,g.from,g.to,z)))return;a.inputState.composing>=0&&a.inputState.composing++;let A;if(g.from>=i.from&&g.to<=i.to&&g.to-g.from>=(i.to-i.from)/3&&(!h||h.main.empty&&h.main.from==g.from+g.insert.length)&&a.inputState.composing<0){let B=i.from<g.from?y.sliceDoc(i.from,g.from):"",C=i.to>g.to?y.sliceDoc(g.to,i.to):"";A=y.replaceSelection(a.state.toText(B+g.insert.sliceString(0,void 0,a.state.lineBreak)+C))}else{let D=y.changes(g),E=h&&!y.selection.main.eq(h.main)&&h.main.to<=D.newLength?h.main:void 0;if(y.selection.ranges.length>1&&a.inputState.composing>=0&&g.to<=i.to&&g.to>=i.to-10){let F=a.state.sliceDoc(g.from,g.to),G=xk(a)||a.state.doc.lineAt(i.head),H=i.to-g.to,I=i.to-i.from;A=y.changeByRange(b=>{if(b.from==i.from&&b.to==i.to)return{changes:D,range:E||b.map(D)};let c=b.to-H,e=c-F.length;if(b.to-b.from!=I||a.state.sliceDoc(e,c)!=F||G&&b.to>=G.from&&b.from<=G.to)return{range:b};let f=y.changes({from:e,to:c,insert:g.insert}),h=b.to-i.to;return{changes:f,range:E?d.jT.range(Math.max(0,E.anchor+h),Math.max(0,E.head+h)):b.map(f)}})}else A={changes:D,selection:E&&y.selection.replaceRange(E)}}let J="input.type";a.composing&&(J+=".compose",a.inputState.compositionFirstChange&&(J+=".start",a.inputState.compositionFirstChange=!1)),a.dispatch(A,{scrollIntoView:!0,userEvent:J})}else if(h&&!h.main.eq(i)){let K=!1,L="select";a.inputState.lastSelectionTime>Date.now()-50&&("select"==a.inputState.lastSelectionOrigin&&(K=!0),L=a.inputState.lastSelectionOrigin),a.dispatch({selection:h,scrollIntoView:K,userEvent:L})}}}(this,a,b,c)},a=>{this.inputState.runScrollHandlers(this,a),this.observer.intersecting&&this.measure()}),this.inputState=new class{constructor(lu){for(let mu in this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null,rl){let nu=rl[mu];lu.contentDOM.addEventListener(mu,a=>{!("keydown"==mu&&this.keydown(lu,a))&&(!ql(lu,a)||this.ignoreDuringComposition(a)||(this.mustFlushObserver(a)&&lu.observer.forceFlush(),this.runCustomHandlers(mu,lu,a)?a.preventDefault():nu(lu,a)))}),this.registeredEvents.push(mu)}this.notifiedFocused=lu.hasFocus,this.ensureHandlers(lu),ib.safari&&lu.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(ou){this.lastSelectionOrigin=ou,this.lastSelectionTime=Date.now()}ensureHandlers(pu){let qu=this.customHandlers=pu.pluginField(qg);for(let ru of qu)for(let su in ru.handlers)0>this.registeredEvents.indexOf(su)&&"scroll"!=su&&(this.registeredEvents.push(su),pu.contentDOM.addEventListener(su,a=>{!!ql(pu,a)&&this.runCustomHandlers(su,pu,a)&&a.preventDefault()}))}runCustomHandlers(tu,uu,vu){for(let wu of this.customHandlers){let xu=wu.handlers[tu];if(xu)try{if(xu.call(wu.plugin,vu,uu)||vu.defaultPrevented)return!0}catch(yu){Wf(uu.state,yu)}}return!1}runScrollHandlers(zu,Au){for(let Bu of this.customHandlers){let Cu=Bu.handlers.scroll;if(Cu)try{Cu.call(Bu.plugin,Au,zu)}catch(Du){Wf(zu.state,Du)}}}keydown(Eu,Fu){if(this.lastKeyCode=Fu.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(Eu,Fu))return!0;if(ib.android&&ib.chrome&&!Fu.synthetic&&(13==Fu.keyCode||8==Fu.keyCode))return Eu.observer.delayAndroidKey(Fu.key,Fu.keyCode),!0;let Gu;return!!(ib.ios&&(Gu=Yk.find(a=>a.keyCode==Fu.keyCode)))&&!(Fu.ctrlKey||Fu.altKey||Fu.metaKey)&&!Fu.synthetic&&(this.pendingIOSKey=Gu,setTimeout(()=>this.flushIOSKey(Eu),250),!0)}flushIOSKey(Hu){let Iu=this.pendingIOSKey;return!!Iu&&(this.pendingIOSKey=void 0,x(Hu.contentDOM,Iu.key,Iu.keyCode))}ignoreDuringComposition(Ju){return!!/^key/.test(Ju.type)&&(this.composing>0|| !!(ib.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(Ku,Lu){let Mu=9==Lu.keyCode&&Date.now()<this.lastEscPress+2000;return 27==Lu.keyCode?this.lastEscPress=Date.now():0>Zk.indexOf(Lu.keyCode)&&(this.lastEscPress=0),Mu}mustFlushObserver(Nu){return"keydown"==Nu.type&&229!=Nu.keyCode||"compositionend"==Nu.type&&!ib.ios}startMouseSelection(Ou){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=Ou}update(Pu){this.mouseSelection&&this.mouseSelection.update(Pu),Pu.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}(this),this.docView=new xi(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,window.addEventListener("resize",()=>{-1==Nw&&(Nw=setTimeout(Ow,50))}),this.requestMeasure(),nt.parent&&nt.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}dispatch(...Qu){this._dispatch(1==Qu.length&&Qu[0]instanceof d.YW?Qu[0]:this.state.update(...Qu))}update(Ru){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let Su=!1,Tu,Uu=this.state;for(let Vu of Ru){if(Vu.startState!=Uu)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");Uu=Vu.state}if(this.destroyed){this.viewState.state=Uu;return}if(Uu.facet(d.yy.phrases)!=this.state.facet(d.yy.phrases))return this.setState(Uu);Tu=new fh(this,Uu,Ru);let Wu=this.viewState.scrollTarget;try{for(let Xu of(this.updateState=2,Ru)){if(Wu&&(Wu=Wu.map(Xu.changes)),Xu.scrollIntoView){let{main:Yu}=Xu.state.selection;Wu=new Of(Yu.empty?Yu:d.jT.cursor(Yu.head,Yu.head>Yu.anchor?-1:1))}for(let Zu of Xu.effects)Zu.is(Mf)?Wu=new Of(Zu.value):Zu.is(Nf)?Wu=new Of(Zu.value,"center"):Zu.is(Vf)&&(Wu=Zu.value)}this.viewState.update(Tu,Wu),this.bidiCache=Qw.update(this.bidiCache,Tu.changes),Tu.empty||(this.updatePlugins(Tu),this.inputState.update(Tu)),Su=this.docView.update(Tu),this.state.facet(Ig)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(Ru),this.docView.updateSelection(Su,Ru.some(a=>a.isUserEvent("select.pointer")))}finally{this.updateState=0}if(Tu.startState.facet(bt)!=Tu.state.facet(bt)&&(this.viewState.mustMeasureContent=!0),(Su||Wu||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!Tu.empty)for(let $u of this.state.facet(Kf))$u(Tu)}setState(_u){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=_u;return}this.updateState=2;let av=this.hasFocus;try{for(let bv of this.plugins)bv.destroy(this);for(let cv of(this.viewState=new uq(_u),this.plugins=_u.facet(cg).map(a=>new rg(a)),this.pluginMap.clear(),this.plugins))cv.update(this);this.docView=new xi(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}av&&this.focus(),this.requestMeasure()}updatePlugins(dv){let ev=dv.startState.facet(cg),fv=dv.state.facet(cg);if(ev!=fv){let gv=[];for(let hv of fv){let iv=ev.indexOf(hv);if(iv<0)gv.push(new rg(hv));else{let jv=this.plugins[iv];jv.mustUpdate=dv,gv.push(jv)}}for(let kv of this.plugins)kv.mustUpdate!=dv&&kv.destroy(this);this.plugins=gv,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let lv of this.plugins)lv.mustUpdate=dv;for(let mv=0;mv<this.plugins.length;mv++)this.plugins[mv].update(this)}measure(nv=!0){if(this.destroyed)return;this.measureScheduled> -1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,nv&&this.observer.flush();let ov=null;try{for(let pv=0;;pv++){this.updateState=1;let qv=this.viewport,rv=this.viewState.measure(this);if(!rv&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(pv>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let sv=[];4&rv||([this.measureRequests,sv]=[sv,this.measureRequests]);let tv=sv.map(a=>{try{return a.read(this)}catch(b){return Wf(this.state,b),Pw}}),uv=new fh(this,this.state),vv=!1,wv=!1;uv.flags|=rv,ov?ov.flags|=rv:ov=uv,this.updateState=2,uv.empty||(this.updatePlugins(uv),this.inputState.update(uv),this.updateAttrs(),vv=this.docView.update(uv));for(let xv=0;xv<sv.length;xv++)if(tv[xv]!=Pw)try{let yv=sv[xv];yv.write&&yv.write(tv[xv],this)}catch(zv){Wf(this.state,zv)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,wv=!0),vv&&this.docView.updateSelection(!0),this.viewport.from==qv.from&&this.viewport.to==qv.to&&!wv&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(ov&&!ov.empty)for(let Av of this.state.facet(Kf))Av(ov)}get themeClasses(){return dt+" "+(this.state.facet(ct)?ft:et)+" "+this.state.facet(bt)}updateAttrs(){let Bv=_w(this,Fg,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),Cv={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Xf)?"true":"false",class:"cm-content",style:`${ib.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(Cv["aria-readonly"]="true"),_w(this,Gg,Cv),this.observer.ignore(()=>{Sc(this.contentDOM,this.contentAttrs,Cv),Sc(this.dom,this.editorAttrs,Bv)}),this.editorAttrs=Bv,this.contentAttrs=Cv}showAnnouncements(Dv){let Ev=!0;for(let Fv of Dv)for(let Gv of Fv.effects)Gv.is(mt.announce)&&(Ev&&(this.announceDOM.textContent=""),Ev=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=Gv.value)}mountStyles(){this.styleModules=this.state.facet(Ig),f.V.mount(this.root,this.styleModules.concat(it).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled> -1&&this.measure(!1)}requestMeasure(Hv){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),Hv){if(null!=Hv.key){for(let Iv=0;Iv<this.measureRequests.length;Iv++)if(this.measureRequests[Iv].key===Hv.key){this.measureRequests[Iv]=Hv;return}}this.measureRequests.push(Hv)}}pluginField(Jv){let Kv=[];for(let Lv of this.plugins)Lv.update(this).takeField(Jv,Kv);return Kv}plugin(Mv){let Nv=this.pluginMap.get(Mv);return(void 0===Nv||Nv&&Nv.spec!=Mv)&&this.pluginMap.set(Mv,Nv=this.plugins.find(a=>a.spec==Mv)||null),Nv&&Nv.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(Ov,Pv){let Qv=Mw(Pv,this);return this.elementAtHeight(Ov-Qv).moveY(Qv)}elementAtHeight(Rv){return this.readMeasured(),this.viewState.elementAtHeight(Rv)}visualLineAtHeight(Sv,Tv){let Uv=Mw(Tv,this);return this.lineBlockAtHeight(Sv-Uv).moveY(Uv)}lineBlockAtHeight(Vv){return this.readMeasured(),this.viewState.lineBlockAtHeight(Vv)}viewportLines(Wv,Xv){let Yv=Mw(Xv,this);for(let Zv of this.viewportLineBlocks)Wv(Zv.moveY(Yv))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt($v,_v=0){return this.lineBlockAt($v).moveY(_v+this.viewState.paddingTop)}lineBlockAt(aw){return this.viewState.lineBlockAt(aw)}get contentHeight(){return this.viewState.contentHeight}moveByChar(bw,cw,dw){return Xk(this,bw,Wk(this,bw,cw,dw))}moveByGroup(ew,fw){return Xk(this,ew,Wk(this,ew,fw,a=>{var b,c,e;let f,g;return b=this,c=ew.head,e=a,g=(f=b.state.charCategorizer(c))(e),a=>{let b=f(a);return g==d.D0.Space&&(g=b),g==b}}))}moveToLineBoundary(gw,hw,iw=!0){return(function(a,b,c,e){let f=a.state.doc.lineAt(b.head),g=e&&a.lineWrapping?a.coordsAtPos(b.assoc<0&&b.head>f.from?b.head-1:b.head):null;if(g){let h=a.dom.getBoundingClientRect(),i=a.posAtCoords({x:c==(a.textDirection==nh.LTR)?h.right-1:h.left+1,y:(g.top+g.bottom)/2});if(null!=i)return d.jT.cursor(i,c?-1:1)}let j=Od.find(a.docView,b.head),k=j?c?j.posAtEnd:j.posAtStart:c?f.to:f.from;return d.jT.cursor(k,c?-1:1)})(this,gw,hw,iw)}moveVertically(jw,kw,lw){return Xk(this,jw,function(a,b,c,e){let f=b.head,g=c?1:-1;if(f==(c?a.state.doc.length:0))return d.jT.cursor(f,b.assoc);let h=b.goalColumn,i,j=a.contentDOM.getBoundingClientRect(),k=a.coordsAtPos(f),l=a.documentTop;if(k)null==h&&(h=k.left-j.left),i=g<0?k.top:k.bottom;else{let m=a.viewState.lineBlockAt(f-l);null==h&&(h=Math.min(j.right-j.left,a.defaultCharacterWidth*(f-m.from))),i=(g<0?m.top:m.bottom)+l}let n=j.left+h,o=null!=e?e:a.defaultLineHeight>>1;for(let p=0;;p+=10){let q=i+(o+p)*g,r=Tk(a,{x:n,y:q},!1,g);if(q<j.top||q>j.bottom||(g<0?r<f:r>f))return d.jT.cursor(r,b.assoc,void 0,h)}}(this,jw,kw,lw))}scrollPosIntoView(mw){this.dispatch({effects:Mf.of(d.jT.cursor(mw))})}domAtPos(nw){return this.docView.domAtPos(nw)}posAtDOM(ow,pw=0){return this.docView.posFromDOM(ow,pw)}posAtCoords(qw,rw=!0){return this.readMeasured(),Tk(this,qw,rw)}coordsAtPos(sw,tw=1){this.readMeasured();let uw=this.docView.coordsAt(sw,tw);if(!uw||uw.left==uw.right)return uw;let vw=this.state.doc.lineAt(sw),ww=this.bidiSpans(vw);return r(uw,ww[Ah.find(ww,sw-vw.from,-1,tw)].dir==nh.LTR==tw>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(xw){if(xw.length>Lw)return Oh(xw.length);let yw=this.textDirection;for(let zw of this.bidiCache)if(zw.from==xw.from&&zw.dir==yw)return zw.order;let Aw=function(a,b){let c=a.length,d=b==oh?1:2,e=b==oh?2:1;if(!a||1==d&&!zh.test(a))return Oh(c);for(let f=0,g=d,h=d;f<c;f++){let i=yh(a.charCodeAt(f));512==i?i=g:8==i&&4==h&&(i=16),Nh[f]=4==i?2:i,7&i&&(h=i),g=i}for(let j=0,k=d,l=d;j<c;j++){let m=Nh[j];if(128==m)j<c-1&&k==Nh[j+1]&&24&k?m=Nh[j]=k:Nh[j]=256;else if(64==m){let n=j+1;for(;n<c&&64==Nh[n];)n++;let o=j&&8==k||n<c&&8==Nh[n]?1==l?1:8:256;for(let p=j;p<n;p++)Nh[p]=o;j=n-1}else 8==m&&1==l&&(Nh[j]=1);k=m,7&m&&(l=m)}for(let q=0,r=0,s=0,t,u,v;q<c;q++)if(u=th[t=a.charCodeAt(q)])if(u<0){for(let w=r-3;w>=0;w-=3)if(uh[w+1]== -u){let x=uh[w+2],y=2&x?d:4&x?1&x?e:d:0;y&&(Nh[q]=Nh[uh[w]]=y),r=w;break}}else if(189==uh.length)break;else uh[r++]=q,uh[r++]=t,uh[r++]=s;else if(2==(v=Nh[q])||1==v){let z=v==d;s=z?0:1;for(let A=r-3;A>=0;A-=3){let B=uh[A+2];if(2&B)break;if(z)uh[A+2]|=2;else{if(4&B)break;uh[A+2]|=4}}}for(let C=0;C<c;C++)if(256==Nh[C]){let D=C+1;for(;D<c&&256==Nh[D];)D++;let E=(C?Nh[C-1]:d)==1,F=E==((D<c?Nh[D]:d)==1)?E?1:2:d;for(let G=C;G<D;G++)Nh[G]=F;C=D-1}let H=[];if(1==d)for(let I=0;I<c;){let J=I,K=1!=Nh[I++];for(;I<c&&K==(1!=Nh[I]);)I++;if(K)for(let L=I;L>J;){let M=L,N=2!=Nh[--L];for(;L>J&&N==(2!=Nh[L-1]);)L--;H.push(new Ah(L,M,N?2:1))}else H.push(new Ah(J,I,0))}else for(let O=0;O<c;){let P=O,Q=2==Nh[O++];for(;O<c&&Q==(2==Nh[O]);)O++;H.push(new Ah(P,O,Q?1:2))}return H}(xw.text,this.textDirection);return this.bidiCache.push(new Qw(xw.from,xw.to,yw,Aw)),Aw}get hasFocus(){var Bw;return(document.hasFocus()||ib.safari&&(null===(Bw=this.inputState)|| void 0===Bw?void 0:Bw.lastContextMenu)>Date.now()-30e3)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{u(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let Cw of this.plugins)Cw.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled> -1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(Dw,Ew={}){return Vf.of(new Of("number"==typeof Dw?d.jT.cursor(Dw):Dw,Ew.y,Ew.x,Ew.yMargin,Ew.xMargin))}static domEventHandlers(Fw){return dg.define(()=>({}),{eventHandlers:Fw})}static theme(Gw,Hw){let Iw=f.V.newName(),Jw=[bt.of(Iw),Ig.of(ht(`.${Iw}`,Gw))];return Hw&&Hw.dark&&Jw.push(ct.of(!0)),Jw}static baseTheme(Kw){return d.Wl.lowest(Ig.of(ht("."+dt,Kw,gt)))}}mt.scrollTo=Mf,mt.centerOn=Nf,mt.styleModule=Ig,mt.inputHandler=Lf,mt.exceptionSink=Jf,mt.updateListener=Kf,mt.editable=Xf,mt.mouseSelectionStyle=If,mt.dragMovesSelection=Hf,mt.clickAddsSelectionRange=Gf,mt.decorations=Hg,mt.darkTheme=ct,mt.contentAttributes=Gg,mt.editorAttributes=Fg,mt.lineWrapping=mt.contentAttributes.of({"class":"cm-lineWrapping"}),mt.announce=d.Py.define();const Lw=4096;function Mw(a,b){return(null==a?b.contentDOM.getBoundingClientRect().top:a)+b.viewState.paddingTop}let Nw=-1;function Ow(){Nw=-1;let a=document.querySelectorAll(".cm-content");for(let b=0;b<a.length;b++){let c=I.get(a[b]);c&&c.editorView.requestMeasure()}}const Pw={};class Qw{constructor(Rw,Sw,Tw,Uw){this.from=Rw,this.to=Sw,this.dir=Tw,this.order=Uw}static update(Vw,Ww){if(Ww.empty)return Vw;let Xw=[],Yw=Vw.length?Vw[Vw.length-1].dir:nh.LTR;for(let Zw=Math.max(0,Vw.length-10);Zw<Vw.length;Zw++){let $w=Vw[Zw];$w.dir!=Yw||Ww.touchesRange($w.from,$w.to)||Xw.push(new Qw(Ww.mapPos($w.from,1),Ww.mapPos($w.to,-1),$w.dir,$w.order))}return Xw}}function _w(a,b,c){for(let d=a.state.facet(b),e=d.length-1;e>=0;e--){let f=d[e],g="function"==typeof f?f(a):f;g&&Qc(g,c)}return c}const ax=ib.mac?"mac":ib.windows?"win":ib.linux?"linux":"key";function bx(a,b,c){return b.altKey&&(a="Alt-"+a),b.ctrlKey&&(a="Ctrl-"+a),b.metaKey&&(a="Meta-"+a),!1!==c&&b.shiftKey&&(a="Shift-"+a),a}const cx=mt.domEventHandlers({keydown(a,b){return jx(fx(b.state),a,b,"editor")}}),dx=d.r$.define({enables:cx}),ex=new WeakMap();function fx(a){let b=a.facet(dx),c=ex.get(b);return c||ex.set(b,c=ix(b.reduce((a,b)=>a.concat(b),[]))),c}function gx(a,b,c){return jx(fx(a.state),b,a,c)}let hx=null;function ix(a,b=ax){let c=Object.create(null),d=Object.create(null),e=(a,b)=>{let c=d[a];if(null==c)d[a]=b;else if(c!=b)throw new Error("Key binding "+a+" is used both as a regular binding and as a multi-stroke prefix")},f=(a,d,f,g)=>{let h=c[a]||(c[a]=Object.create(null)),i=d.split(/ (?!$)/).map(a=>(function(a,b){const c=a.split(/-(?!$)/);let d=c[c.length-1];"Space"==d&&(d=" ");let e,f,g,h;for(let i=0;i<c.length-1;++i){const j=c[i];if(/^(cmd|meta|m)$/i.test(j))h=!0;else if(/^a(lt)?$/i.test(j))e=!0;else if(/^(c|ctrl|control)$/i.test(j))f=!0;else if(/^s(hift)?$/i.test(j))g=!0;else if(/^mod$/i.test(j))"mac"==b?h=!0:f=!0;else throw new Error("Unrecognized modifier name: "+j)}return e&&(d="Alt-"+d),f&&(d="Ctrl-"+d),h&&(d="Meta-"+d),g&&(d="Shift-"+d),d})(a,b));for(let j=1;j<i.length;j++){let k=i.slice(0,j).join(" ");e(k,!0),h[k]||(h[k]={preventDefault:!0,commands:[b=>{let c=hx={view:b,prefix:k,scope:a};return setTimeout(()=>{hx==c&&(hx=null)},4000),!0}]})}let l=i.join(" ");e(l,!1);let m=h[l]||(h[l]={preventDefault:!1,commands:[]});m.commands.push(f),g&&(m.preventDefault=!0)};for(let g of a){let h=g[b]||g.key;if(h)for(let i of g.scope?g.scope.split(" "):["editor"])f(i,h,g.run,g.preventDefault),g.shift&&f(i,"Shift-"+h,g.shift,g.preventDefault)}return c}function jx(a,b,c,d){let e=(0,h.YG)(b),f=1==e.length&&" "!=e,g="",i=!1;hx&&hx.view==c&&hx.scope==d&&(g=hx.prefix+" ",(i=0>Zk.indexOf(b.keyCode))&&(hx=null));let j=a=>{if(a){for(let b of a.commands)if(b(c))return!0;a.preventDefault&&(i=!0)}return!1},k=a[d],l;if(k){if(j(k[g+bx(e,b,!f)]))return!0;if(f&&(b.shiftKey||b.altKey||b.metaKey)&&(l=h.ue[b.keyCode])&&l!=e){if(j(k[g+bx(l,b,!0)]))return!0}else if(f&&b.shiftKey&&j(k[g+bx(e,b,!0)]))return!0}return i}const kx=!ib.ios,lx=d.r$.define({combine(a){return(0,d.BO)(a,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(a,b)=>Math.min(a,b),drawRangeCursor:(a,b)=>a||b})}});function mx(a={}){return[lx.of(a),wx,Nx]}class nx{constructor(ox,px,qx,rx,sx){this.left=ox,this.top=px,this.width=qx,this.height=rx,this.className=sx}draw(){let tx=document.createElement("div");return tx.className=this.className,this.adjust(tx),tx}adjust(ux){ux.style.left=this.left+"px",ux.style.top=this.top+"px",this.width>=0&&(ux.style.width=this.width+"px"),ux.style.height=this.height+"px"}eq(vx){return this.left==vx.left&&this.top==vx.top&&this.width==vx.width&&this.height==vx.height&&this.className==vx.className}}const wx=dg.fromClass(class{constructor(xx){this.view=xx,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=xx.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=xx.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),xx.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(lx).cursorBlinkRate+"ms"}update(yx){let zx=yx.startState.facet(lx)!=yx.state.facet(lx);(zx||yx.selectionSet||yx.geometryChanged||yx.viewportChanged)&&this.view.requestMeasure(this.measureReq),yx.transactions.some(a=>a.scrollIntoView)&&(this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink"),zx&&this.setBlinkRate()}readPos(){let{state:Ax}=this.view,Bx=Ax.facet(lx),Cx=Ax.selection.ranges.map(a=>a.empty?[]:Rx(this.view,a)).reduce((a,b)=>a.concat(b)),Dx=[];for(let Ex of Ax.selection.ranges){let Fx=Ex==Ax.selection.main;if(Ex.empty?!Fx||kx:Bx.drawRangeCursor){let Gx=Sx(this.view,Ex,Fx);Gx&&Dx.push(Gx)}}return{rangePieces:Cx,cursors:Dx}}drawSel({rangePieces:Hx,cursors:Ix}){if(Hx.length!=this.rangePieces.length||Hx.some((a,b)=>!a.eq(this.rangePieces[b]))){for(let Jx of(this.selectionLayer.textContent="",Hx))this.selectionLayer.appendChild(Jx.draw());this.rangePieces=Hx}if(Ix.length!=this.cursors.length||Ix.some((a,b)=>!a.eq(this.cursors[b]))){let Kx=this.cursorLayer.children;if(Kx.length!==Ix.length)for(const Lx of(this.cursorLayer.textContent="",Ix))this.cursorLayer.appendChild(Lx.draw());else Ix.forEach((a,b)=>a.adjust(Kx[b]));this.cursors=Ix}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),Mx={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};kx&&(Mx[".cm-line"].caretColor="transparent !important");const Nx=d.Wl.highest(mt.theme(Mx));function Ox(a){let b=a.scrollDOM.getBoundingClientRect();return{left:(a.textDirection==nh.LTR?b.left:b.right-a.scrollDOM.clientWidth)-a.scrollDOM.scrollLeft,top:b.top-a.scrollDOM.scrollTop}}function Px(a,b,c){let e=d.jT.cursor(b);return{from:Math.max(c.from,a.moveToLineBoundary(e,!1,!0).from),to:Math.min(c.to,a.moveToLineBoundary(e,!0,!0).from),type:$c.Text}}function Qx(a,b){let c=a.lineBlockAt(b);if(Array.isArray(c.type)){for(let d of c.type)if(d.to>b||d.to==b&&(d.to==c.to||d.type==$c.Text))return d}return c}function Rx(a,b){if(b.to<=a.viewport.from||b.from>=a.viewport.to)return[];let c=Math.max(b.from,a.viewport.from),d=Math.min(b.to,a.viewport.to),e=a.textDirection==nh.LTR,f=a.contentDOM,g=f.getBoundingClientRect(),h=Ox(a),i=window.getComputedStyle(f.firstChild),j=g.left+parseInt(i.paddingLeft)+Math.min(0,parseInt(i.textIndent)),k=g.right-parseInt(i.paddingRight),l=Qx(a,c),m=Qx(a,d),n=l.type==$c.Text?l:null,o=m.type==$c.Text?m:null;if(a.lineWrapping&&(n&&(n=Px(a,c,n)),o&&(o=Px(a,d,o))),n&&o&&n.from==o.from)return t(u(b.from,b.to,n));{let p=n?u(b.from,null,n):v(l,!1),q=o?u(null,b.to,o):v(m,!0),r=[];return(n||l).to<(o||m).from-1?r.push(s(j,p.bottom,k,q.top)):p.bottom<q.top&&a.elementAtHeight((p.bottom+q.top)/2).type==$c.Text&&(p.bottom=q.top=(p.bottom+q.top)/2),t(p).concat(r).concat(t(q))}function s(a,b,c,d){return new nx(a-h.left,b-h.top-0.01,c-a,d-b+0.01,"cm-selectionBackground")}function t({top:a,bottom:b,horizontal:c}){let d=[];for(let e=0;e<c.length;e+=2)d.push(s(c[e],a,c[e+1],b));return d}function u(b,c,d){let f=10e8,g=-10e8,h=[];function i(b,c,i,l,m){let n=a.coordsAtPos(b,b==d.to?-2:2),o=a.coordsAtPos(i,i==d.from?2:-2);f=Math.min(n.top,o.top,f),g=Math.max(n.bottom,o.bottom,g),m==nh.LTR?h.push(e&&c?j:n.left,e&&l?k:o.right):h.push(!e&&l?j:o.left,!e&&c?k:n.right)}let l=null!=b?b:d.from,m=null!=c?c:d.to;for(let n of a.visibleRanges)if(n.to>l&&n.from<m)for(let o=Math.max(n.from,l),p=Math.min(n.to,m);;){let q=a.state.doc.lineAt(o);for(let r of a.bidiSpans(q)){let s=r.from+q.from,t=r.to+q.from;if(s>=p)break;t>o&&i(Math.max(s,o),null==b&&s<=l,Math.min(t,p),null==c&&t>=m,r.dir)}if((o=q.to+1)>=p)break}return 0==h.length&&i(l,null==b,m,null==c,a.textDirection),{top:f,bottom:g,horizontal:h}}function v(a,b){let c=g.top+(b?a.top:a.bottom);return{top:c,bottom:c,horizontal:[]}}}function Sx(a,b,c){let d=a.coordsAtPos(b.head,b.assoc||1);if(!d)return null;let e=Ox(a);return new nx(d.left-e.left,d.top-e.top,-1,d.bottom-d.top,c?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const Tx=d.Py.define({map(a,b){return null==a?null:b.mapPos(a)}}),Ux=d.QQ.define({create(){return null},update(a,b){return null!=a&&(a=b.changes.mapPos(a)),b.effects.reduce((a,b)=>b.is(Tx)?b.value:a,a)}}),Vx=dg.fromClass(class{constructor(Wx){this.view=Wx,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(Xx){var Yx;let Zx=Xx.state.field(Ux);null==Zx?null!=this.cursor&&(null===(Yx=this.cursor)|| void 0===Yx||Yx.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(Xx.startState.field(Ux)!=Zx||Xx.docChanged||Xx.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let $x=this.view.state.field(Ux),_x=null!=$x&&this.view.coordsAtPos($x);if(!_x)return null;let ay=this.view.scrollDOM.getBoundingClientRect();return{left:_x.left-ay.left+this.view.scrollDOM.scrollLeft,top:_x.top-ay.top+this.view.scrollDOM.scrollTop,height:_x.bottom-_x.top}}drawCursor(by){this.cursor&&(by?(this.cursor.style.left=by.left+"px",this.cursor.style.top=by.top+"px",this.cursor.style.height=by.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(cy){this.view.state.field(Ux)!=cy&&this.view.dispatch({effects:Tx.of(cy)})}},{eventHandlers:{dragover(a){this.setDropPos(this.view.posAtCoords({x:a.clientX,y:a.clientY}))},dragleave(a){a.target!=this.view.contentDOM&&this.view.contentDOM.contains(a.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dy(){return[Ux,Vx]}function ey(a,b,c,d,e){b.lastIndex=0;for(let f=a.iterRange(c,d),g=c,h;!f.next().done;g+=f.value.length)if(!f.lineBreak)for(;h=b.exec(f.value);)e(g+h.index,g+h.index+h[0].length,h)}class fy{constructor(gy){let{regexp:hy,decoration:iy,boundary:jy,maxLength:ky=1000}=gy;if(!hy.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=hy,this.getDeco="function"==typeof iy?iy:()=>iy,this.boundary=jy,this.maxLength=ky}createDeco(ly){let my=new g.f_();for(let{from:ny,to:oy}of(function(a,b){let c=a.visibleRanges;if(1==c.length&&c[0].from==a.viewport.from&&c[0].to==a.viewport.to)return c;let d=[];for(let{from:e,to:f}of c)e=Math.max(a.state.doc.lineAt(e).from,e-b),f=Math.min(a.state.doc.lineAt(f).to,f+b),d.length&&d[d.length-1].to>=e?d[d.length-1].to=f:d.push({from:e,to:f});return d})(ly,this.maxLength))ey(ly.state.doc,this.regexp,ny,oy,(a,b,c)=>my.add(a,b,this.getDeco(c,ly,a)));return my.finish()}updateDeco(py,qy){let ry=10e8,sy=-1;return(py.docChanged&&py.changes.iterChanges((a,b,c,d)=>{d>py.view.viewport.from&&c<py.view.viewport.to&&(ry=Math.min(c,ry),sy=Math.max(d,sy))}),py.viewportChanged||sy-ry>1000)?this.createDeco(py.view):sy> -1?this.updateRange(py.view,qy.map(py.changes),ry,sy):qy}updateRange(ty,uy,vy,wy){for(let xy of ty.visibleRanges){let yy=Math.max(xy.from,vy),zy=Math.min(xy.to,wy);if(zy>yy){let Ay=ty.state.doc.lineAt(yy),By=Ay.to<zy?ty.state.doc.lineAt(zy):Ay,Cy=Math.max(xy.from,Ay.from),Dy=Math.min(xy.to,By.to);if(this.boundary){for(;yy>Ay.from;yy--)if(this.boundary.test(Ay.text[yy-1-Ay.from])){Cy=yy;break}for(;zy<By.to;zy++)if(this.boundary.test(By.text[zy-By.from])){Dy=zy;break}}let Ey=[],Fy;if(Ay==By)for(this.regexp.lastIndex=Cy-Ay.from;(Fy=this.regexp.exec(Ay.text))&&Fy.index<Dy-Ay.from;){let Gy=Fy.index+Ay.from;Ey.push(this.getDeco(Fy,ty,Gy).range(Gy,Gy+Fy[0].length))}else ey(ty.state.doc,this.regexp,Cy,Dy,(a,b,c)=>Ey.push(this.getDeco(c,ty,a).range(a,b)));uy=uy.update({filterFrom:Cy,filterTo:Dy,filter:(a,b)=>a<Cy||b>Dy,add:Ey})}}return uy}}const Hy=null!=/x/.unicode?"gu":"g",Iy=new RegExp("[\x00-\b\n-\x1f\x7f-\x9f\xad؜​‎‏\u2028\u2029‭‮﻿￹-￼]",Hy),Jy={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Ky=null;const Ly=d.r$.define({combine(a){let b=(0,d.BO)(a,{render:null,specialChars:Iy,addSpecialChars:null});return(b.replaceTabs=!function(){var a;if(null==Ky&&"undefined"!=typeof document&&document.body){let b=document.body.style;Ky=(null!==(a=b.tabSize)&& void 0!==a?a:b.MozTabSize)!=null}return Ky||!1}())&&(b.specialChars=new RegExp("\t|"+b.specialChars.source,Hy)),b.addSpecialChars&&(b.specialChars=new RegExp(b.specialChars.source+"|"+b.addSpecialChars.source,Hy)),b}});function My(a={}){return[Ly.of(a),Oy()]}let Ny=null;function Oy(){return Ny||(Ny=dg.fromClass(class{constructor(a){this.view=a,this.decorations=_c.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(a.state.facet(Ly)),this.decorations=this.decorator.createDeco(a)}makeDecorator(b){return new fy({regexp:b.specialChars,decoration:(a,c,d)=>{let{doc:f}=c.state,g=(0,e.gm)(a[0],0);if(9==g){let h=f.lineAt(d),i=c.state.tabSize,j=(0,e.IS)(h.text,i,d-h.from);return _c.replace({widget:new Zy((i-j%i)*this.view.defaultCharacterWidth)})}return this.decorationCache[g]||(this.decorationCache[g]=_c.replace({widget:new Py(b,g)}))},boundary:b.replaceTabs?void 0:/[^]/})}update(c){let d=c.state.facet(Ly);c.startState.facet(Ly)!=d?(this.decorator=this.makeDecorator(d),this.decorations=this.decorator.createDeco(c.view)):this.decorations=this.decorator.updateDeco(c,this.decorations)}},{decorations:a=>a.decorations}))}class Py extends Tc{constructor(Qy,Ry){super(),this.options=Qy,this.code=Ry}eq(Sy){return Sy.code==this.code}toDOM(Ty){var Uy;let Vy=(Uy=this.code)>=32?"•":10==Uy?"␤":String.fromCharCode(9216+Uy),Wy=Ty.state.phrase("Control character")+" "+(Jy[this.code]||"0x"+this.code.toString(16)),Xy=this.options.render&&this.options.render(this.code,Wy,Vy);if(Xy)return Xy;let Yy=document.createElement("span");return Yy.textContent=Vy,Yy.title=Wy,Yy.setAttribute("aria-label",Wy),Yy.className="cm-specialChar",Yy}ignoreEvent(){return!1}}class Zy extends Tc{constructor($y){super(),this.width=$y}eq(_y){return _y.width==this.width}toDOM(){let az=document.createElement("span");return az.textContent="\t",az.className="cm-tab",az.style.width=this.width+"px",az}ignoreEvent(){return!1}}function bz(){return dz}const cz=_c.line({class:"cm-activeLine"}),dz=dg.fromClass(class{constructor(ez){this.decorations=this.getDeco(ez)}update(fz){(fz.docChanged||fz.selectionSet)&&(this.decorations=this.getDeco(fz.view))}getDeco(gz){let hz=-1,iz=[];for(let jz of gz.state.selection.ranges){if(!jz.empty)return _c.none;let kz=gz.lineBlockAt(jz.head);kz.from>hz&&(iz.push(cz.range(kz.from)),hz=kz.from)}return _c.set(iz)}},{decorations:a=>a.decorations});class lz extends Tc{constructor(mz){super(),this.content=mz}toDOM(){let nz=document.createElement("span");return nz.className="cm-placeholder",nz.style.pointerEvents="none",nz.appendChild("string"==typeof this.content?document.createTextNode(this.content):this.content),"string"==typeof this.content?nz.setAttribute("aria-label","placeholder "+this.content):nz.setAttribute("aria-hidden","true"),nz}ignoreEvent(){return!1}}function oz(a){return dg.fromClass(class{constructor(b){this.view=b,this.placeholder=_c.set([_c.widget({widget:new lz(a),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?_c.none:this.placeholder}},{decorations:a=>a.decorations})}}}])